<!DOCTYPE html>
<html lang="cn">
    <head>
  <!-- 元数据 -->
  <meta charset="utf-8">
  <link rel="icon" href="/images/code.png">
  
  <title>3231note | INAB</title>
  
  <meta name="author" content="Xhmkggybz" />
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="robots" content="index,follow" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="format-detection" content="telphone=no, email=no" />
  
    <meta name="keywords" content="COMP3231" />
  
  <meta name="description" content="UNSW COMP3231 23T1 notes">
<meta property="og:type" content="article">
<meta property="og:title" content="3231note">
<meta property="og:url" content="https://xhmkggybzwmz.github.io/2023/04/26/3231note/index.html">
<meta property="og:site_name" content="INAB">
<meta property="og:description" content="UNSW COMP3231 23T1 notes">
<meta property="og:locale">
<meta property="og:image" content="https://xhmkggybzwmz.github.io/2023/04/26/3231note/cover.png">
<meta property="article:published_time" content="2023-04-25T14:32:58.000Z">
<meta property="article:modified_time" content="2023-06-04T12:40:06.900Z">
<meta property="article:author" content="Xhmkggybz">
<meta property="article:tag" content="COMP3231">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://xhmkggybzwmz.github.io/2023/04/26/3231note/cover.png">
  
  <!-- 站点验证相关 -->
  
    
      <meta name="google-site-verification" content="HRiAuheiM4JnZcD_x3qFfHy44Rh7h3BgjtjAhNOI9lQ" />
    
    
    
  
  <!-- 样式表文件 -->
  <link rel="stylesheet" id="kratos-css" href="/css/kratosr.min.css" media="all"></script>
  
    <link rel="stylesheet" id="darkmode-css" href="/css/kr-color-dark.min.css" media="(prefers-color-scheme: dark)"></script>
    <script src="/js/kr-dark.min.js"></script>
  
  
    <link rel="stylesheet" id="highlight-css" href="/css/highlight/night-eighties.min.css" media="all"></script>
  
  <link rel="stylesheet" id="fontawe-css" href="/vendors/font-awesome@4.7.0/css/font-awesome.min.css" media="all"></script>
  <link rel="stylesheet" id="nprogress-css" href="/vendors/nprogress@0.2.0/nprogress.css" media="all"></script>
  
  
    <link rel="stylesheet" href="/vendors/aplayer@1.10.1/dist/APlayer.min.css"></script>
  
  
    <link rel="stylesheet" href="/vendors/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"></script>
  
  <!-- 不得不预先加载的一些JS文件 -->
  <script src="/vendors/jquery@3.6.0/dist/jquery.min.js"></script>
  
    <script src="/vendors/qrcode_js@1.0.0/qrcode.min.js"></script>
  
  
  <style>
    
      .kratos-cover.kratos-cover-2 {
        background-image: url('/images/Mei_header.jpg');
      }
    
    
      @media(min-width:768px) {
        body.custom-background {
          background-image: url('/images/bg.jpg');
        }
      }
    
  </style>
  
<meta name="generator" content="Hexo 6.3.0"></head>


    <body class="custom-background">
        <div id="kratos-wrapper">
    <div id="kratos-page">
        <div id="kratos-header">
            <header id="kratos-desktop-topnav" class="kratos-topnav">
                <div class="container">
                    <div class="nav-header">
                        <nav id="kratos-menu-wrap">
                            <ul id="kratos-primary-menu" class="sf-menu">
                                
                                    
                                        <li>
                                            
                                                <a href="/">
                                            
                                                
                                                    <i class="fa fa-home"></i>
                                                
                                                首页
                                            </a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="/archives/">
                                            
                                                
                                                    <i class="fa fa-file"></i>
                                                
                                                档案馆
                                            </a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="/friends/">
                                            
                                                
                                                    <i class="fa fa-paw"></i>
                                                
                                                好伙伴
                                            </a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a>
                                            
                                                
                                                    <i class="fa fa-link"></i>
                                                
                                                链接
                                            </a>
                                            
                                                <ul class="sub-menu">
                                                    
                                                        <li>
                                                            <a target="_blank" rel="noopener" href="https://github.com/Candinya/Kratos-Rebirth">
                                                                
                                                                项目链接
                                                            </a>
                                                        </li>
                                                    
                                                        <li>
                                                            <a target="_blank" rel="noopener" href="https://space.bilibili.com/347171299">
                                                                
                                                                Bilibili
                                                            </a>
                                                        </li>
                                                    
                                                        <li>
                                                            <a target="_blank" rel="noopener" href="https://github.com/xhmkggybzwmz">
                                                                
                                                                github
                                                            </a>
                                                        </li>
                                                    
                                                </ul>
                                            
                                        </li>
                                    
                                
                            </ul>
                        </nav>
                    </div>
                </div>
            </header>
            <header id="kratos-mobile-topnav" class="kratos-topnav">
                <div class="container">
                    <div class="color-logo"><a href="/">INAB</a></div>
                    <div class="nav-toggle">
                        <a class="kratos-nav-toggle js-kratos-nav-toggle">
                            <i></i>
                        </a>
                    </div>
                </div>
            </header>
        </div>
        <div class="kratos-start kratos-hero-2">
            <!-- <div class="kratos-overlay"></div> -->
            <div class="kratos-cover kratos-cover-2 text-center">
                <div class="desc desc2 animate-box">
                    <a href="/">
                        <h2>INAB</h2> <br />
                        <span></span>
                    </a>
                </div>
            </div>
        </div>

        <div id="kratos-blog-post">
            <div class="container">
                <div id="main" class="row">
                    

        

            <section class="col-md-8">

        

            <article itemscope itemtype="https://schema.org/Article">
    
    <link itemprop="mainEntityOfPage" href="https://xhmkggybzwmz.github.io/2023/04/26/3231note/">
    <div class="kratos-hentry kratos-post-inner clearfix">
        <header class="kratos-entry-header">
            
                <h1 class="kratos-entry-title text-center" itemprop="name headline">3231note</h1>
            
            
            <ul class="kratos-post-meta text-center">
                <li><time datetime="2023-04-25T14:32:58.000Z" itemprop="datePublished"><i class="fa fa-calendar"></i> 2023-04-26</time></li>
                <li itemprop="author" itemscope itemtype="https://schema.org/Person">
                    <i class="fa fa-user"></i> 作者 <span itemprop="name">Xhmkggybz</span>
                </li>
                
                    <li>
                        <i class="fa fa-edit"></i> 
                        
                        
                            ~75.66K
                        
                        字
                    </li>
                
                
            </ul>
        </header>
        <div class="kratos-post-content">
            
            <div id="expire-alert" class="alert alert-warning hidden" role="alert">
                <div class="icon"><i class="fa fa-warning"></i></div>
                <div class="text"><p>本文最后编辑于 <time datetime="1685882406900"></time> 前，其中的内容可能需要更新。</p></div>
            </div>
            
            
            
            <hr />
            <div itemprop="articleBody"><p>UNSW COMP3231 23T1 notes</p>
<span id="more"></span>
<h2 id="Lec-02-Processes-and-Threads"><a href="#Lec-02-Processes-and-Threads" class="headerlink" title="Lec 02 Processes and Threads"></a>Lec 02 Processes and Threads</h2><h3 id="Processes"><a href="#Processes" class="headerlink" title="Processes:"></a><strong>Processes:</strong></h3><p>• Also called a task or job</p>
<p>• Memory image of an individual program</p>
<p>• “Owner” of resources allocated for program execution</p>
<p>• Encompasses one or more threads</p>
<h3 id="Threads"><a href="#Threads" class="headerlink" title="Threads:"></a><strong>Threads:</strong></h3><p>• Unit of execution 执行命令的单位</p>
<p>• Can be traced</p>
<p>• list the sequence of instructions that execute</p>
<p>• Belongs to a process</p>
<p>• Executes within it.</p>
<p>One Process may contain one or more threads.</p>
<img src="/2023/04/26/3231note/1.png" class="" title="Threads">
<h3 id="Process-Termination"><a href="#Process-Termination" class="headerlink" title="Process Termination"></a><strong>Process Termination</strong></h3><p>Conditions which terminate processes</p>
<p>1. Normal exit (voluntary)</p>
<p>2. Error exit (voluntary)</p>
<p>3. Fatal error (involuntary)</p>
<p>4. Killed by another process (involuntary)</p>
<h3 id="Process-and-Thread-States"><a href="#Process-and-Thread-States" class="headerlink" title="Process and Thread States"></a><strong>Process and Thread States</strong></h3><p>Running</p>
<p>Blocked</p>
<p>Ready</p>
<h4 id="Running-→-Ready"><a href="#Running-→-Ready" class="headerlink" title="Running → Ready"></a><strong>Running → Ready</strong></h4><p>• Voluntary Yield()</p>
<p>• End of timeslice</p>
<h4 id="Running-→-Blocked"><a href="#Running-→-Blocked" class="headerlink" title="Running → Blocked"></a><strong>Running → Blocked</strong></h4><p>• Waiting for input</p>
<p>• File, network,</p>
<p>• Waiting for a timer (alarm signal)</p>
<p>• Waiting for a resource to become available</p>
<h3 id="Schedular"><a href="#Schedular" class="headerlink" title="Schedular"></a><strong>Schedular</strong></h3><p>Sometime called as <strong>dispatcher</strong>, it will choose a ready process to run.</p>
<p>BUT: It is inefficient to search through all processes</p>
<p>e.g: Ready Queue &amp; Blocked Queue</p>
<img src="/2023/04/26/3231note/2.png" class="" title="P21_lec02">


<h3 id="Thread-Model"><a href="#Thread-Model" class="headerlink" title="Thread Model"></a><strong>Thread Model</strong></h3><table>
<thead>
<tr>
<th>Per process items</th>
<th>Per thread items</th>
</tr>
</thead>
<tbody><tr>
<td><p>Address space</p><p>Global variables</p><p>Open files</p><p>Child processes</p><p>Pending alarms</p><p>Signals and signal handlers</p><p>Accounting information</p></td>
<td><p>Program counter</p><p>Registers</p><p>Stack (Each thread has its own stack)</p><p>State</p><p><img src="/2023/04/26/3231note/3.png" class="" title="Thread Model"></p></td>
</tr>
</tbody></table>
<p>Local variables are per thread (allocated on the stack)</p>
<p>Global variables are shared between all threads (Allocated in the data section)</p>
<p><strong>Concurrency control is an issue.</strong></p>
<p>Dynamically allocated memory can be global or local -&gt; Program defined</p>
<img src="/2023/04/26/3231note/4.png" class="" title="P29_lec02">

<h3 id="Thread-Usage"><a href="#Thread-Usage" class="headerlink" title="Thread Usage"></a><strong>Thread Usage</strong></h3><table>
<thead>
<tr>
<th><strong>Model 模型</strong></th>
<th><strong>Characteristics 特性</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Threads</td>
<td>Parallelism. Blocking system calls</td>
</tr>
<tr>
<td>Single-threaded Process</td>
<td>No parallelism, blocking system calls</td>
</tr>
<tr>
<td>Finite-state Machine</td>
<td>Parallelism, nonblocking system calls, interrupts</td>
</tr>
</tbody></table>
<h3 id="Summary-in-Threads"><a href="#Summary-in-Threads" class="headerlink" title="Summary in Threads"></a><strong>Summary in Threads</strong></h3><ol>
<li><strong>Simpler to program than a state machine</strong></li>
<li><strong>Less resources associated with threads than multiple complete processes</strong><ol>
<li><strong>Cheaper to create and destroy</strong></li>
<li><strong>Share resources (especially memory) between them</strong></li>
</ol>
</li>
<li><strong>Performance: Threads waiting for IO can be overlapped with computing threads</strong><ol>
<li><strong>If all threads are compute bound(被运算速度限制), then there is no performance improvement (on uniprocessor)</strong></li>
</ol>
</li>
<li><strong>Threads can take advantage of the parallelism available on machines with more than one CPU (multiprocessor)</strong></li>
</ol>
<h2 id="Lec-03-Concurrency-and-Synchronisation"><a href="#Lec-03-Concurrency-and-Synchronisation" class="headerlink" title="Lec 03 Concurrency and Synchronisation"></a>Lec 03 Concurrency and Synchronisation</h2><h3 id="Concurrency-Example"><a href="#Concurrency-Example" class="headerlink" title="Concurrency Example:"></a><strong>Concurrency Example:</strong></h3><p>Trying to modify a global variable in two threads</p>
<img src="/2023/04/26/3231note/5.png" class="" title="Concurrency Example">

<p><strong>The reason for why there is in-kernel concurrency for single-threaded processes:</strong></p>
<ol>
<li>Multi-tasking</li>
<li>Interrupt handling</li>
<li>Device drivers</li>
<li>System calls</li>
<li>Resource sharing</li>
</ol>
<img src="/2023/04/26/3231note/6.png" class="" title="P6_lec03">
<h3 id="Critical-Region-and-how-to-identify"><a href="#Critical-Region-and-how-to-identify" class="headerlink" title="Critical Region and how to identify"></a><strong>Critical Region and how to identify</strong></h3><p>A critical region is a region of code where shared resources are accessed.</p>
<p><strong>We can control access to the shared resource by controlling access to the code that accesses the resource.</strong></p>
<p>Uncoordinated entry to the critical region results in a race condition (<strong>Concurrency Occurs</strong>)</p>
<p><strong>HOW TO IDENTIFY:</strong></p>
<p>Critical regions are the regions of code that </p>
<ol>
<li>access a shared resource,</li>
<li>and correctness <strong>relies on the shared resource not being concurrently modified</strong> by another thread&#x2F;process&#x2F;entity.\</li>
</ol>
<p><strong>HOW TO PREVENT:</strong></p>
<img src="/2023/04/26/3231note/7.png" class="" title="Critical Region">
<h3 id="Critical-Regions-Solutions"><a href="#Critical-Regions-Solutions" class="headerlink" title="Critical Regions Solutions"></a><strong>Critical Regions Solutions</strong></h3><p>Conditions required of any solution to the critical region problem:</p>
<ol>
<li>Mutual exclusion:<ol>
<li>No two processes&#x2F;threads in the critical region at the same time</li>
</ol>
</li>
<li>No assumptions made about speeds or numbers of CPUs</li>
<li>No process running outside its critical region may block another process</li>
<li>No process waited forever to enter its critical region (<strong>Bounded</strong>)</li>
</ol>
<h3 id="Mutual-exclusion-by-taking-turns"><a href="#Mutual-exclusion-by-taking-turns" class="headerlink" title="Mutual exclusion by taking turns"></a><strong>Mutual exclusion by taking turns</strong></h3><p>Works for solving concurrency issues: <strong>strict alternation -&gt; each process takes turns</strong></p>
<p>Cons (缺点)</p>
<ol>
<li>Busy waiting</li>
<li>Process must wait its turn even while the other process is doing something else<ol>
<li>In a multiple processes condition, must wait for everyone to have a turn<ol>
<li>Does not guarantee progress if a process no longer needs a turn</li>
</ol>
</li>
<li>Poor solution when processes require the critical section at different rates</li>
</ol>
</li>
</ol>
<h3 id="Mutual-Exclusion-by-disabling-interrupts"><a href="#Mutual-Exclusion-by-disabling-interrupts" class="headerlink" title="Mutual Exclusion by disabling interrupts"></a><strong>Mutual Exclusion by disabling interrupts</strong></h3><p>How it works:</p>
<p>Before entering a critical region, disable interrupts.</p>
<p>After leaving the critical region, enable interrupts.</p>
<p><strong>Cons:</strong></p>
<ol>
<li>Only available in the kernel</li>
<li>Delays everybody else, even with no contention<ol>
<li>Slows the interrupt response time</li>
</ol>
</li>
<li>Does not work on a multiprocessor</li>
</ol>
<h3 id="Hardware-Support-for-mutual-exclusion"><a href="#Hardware-Support-for-mutual-exclusion" class="headerlink" title="Hardware Support for mutual exclusion"></a><strong>Hardware Support for mutual exclusion</strong></h3><p><strong>Test and Set instruction</strong></p>
<p>•Can be used to implement lock variables correctly</p>
<p>•Load the value of the lock</p>
<p>•If lock &#x3D;&#x3D; 0</p>
<p>•Set the lock to 1</p>
<p>•Return the result 0 -&gt; we acquire the lock</p>
<p>•if lock &#x3D;&#x3D; 1</p>
<p>• return 1 -&gt; another thread&#x2F;process has the lock</p>
<p>•Hardware guarantees that the instruction executes atomically -&gt; not be interrupt</p>
<img src="/2023/04/26/3231note/8.png" class="" title="Test And Set">

<p><strong>Pros:</strong></p>
<ol>
<li>Simple (easy to verify work or not)</li>
<li>Available at user level<ol>
<li>Work with any number of processors</li>
<li>To implement any number of lock variables</li>
</ol>
</li>
</ol>
<p><strong>Cons:</strong></p>
<ol>
<li>Busy waits (also named as a spin lock)<ol>
<li>Consumes CPU</li>
<li>Starvation is possible when a process leaves its critical section and more than one process is waiting.</li>
</ol>
</li>
</ol>
<h3 id="Tackling-the-busy-wait-problem"><a href="#Tackling-the-busy-wait-problem" class="headerlink" title="Tackling the busy-wait problem:"></a><strong>Tackling the busy-wait problem:</strong></h3><p>Sleep&#x2F;Wakeup</p>
<ol>
<li>When the process is waiting for an event, it calls sleep to block, instead of busy waiting.</li>
<li>The event happens, the event generator (another process) calls wakeup to unblock the sleeping process.</li>
<li>Waking a ready&#x2F;running process has no effect.</li>
</ol>
<h3 id="Producer-Consumer-Problem-bounded-buffer-problem"><a href="#Producer-Consumer-Problem-bounded-buffer-problem" class="headerlink" title="Producer-Consumer Problem(bounded buffer problem)"></a><strong>Producer-Consumer Problem(bounded buffer problem)</strong></h3><p>Description: producer produces data items and store items in a buffer.</p>
<p>Consumer takes the items out of the buffer and consumes them.</p>
<img src="/2023/04/26/3231note/9.png" class="" title="Producer Consumer">
<h4 id="Issues"><a href="#Issues" class="headerlink" title="Issues:"></a><strong>Issues:</strong></h4><p>Producer</p>
<p>Should sleep when the buffer is full.</p>
<p>And wakeup when there is empty space in the buffer.</p>
<p>The consumer can call wakeup when it consumes the first entry of the full buffer.</p>
<p>Consumer</p>
<p>Should sleep when the buffer is empty.</p>
<p>And wakeup when there are items available.</p>
<p>Producer can call wakeup when it adds the first item to the buffer.</p>
<h3 id="Semaphores"><a href="#Semaphores" class="headerlink" title="Semaphores"></a><strong>Semaphores</strong></h3><p>Two primitives that are more powerful than simple sleep and wakeup alone.</p>
<p>• P(): proberen, from Dutch to test.</p>
<p>• V(): verhogen, from Dutch to increment.</p>
<p>• Also called <strong>wait &amp; signal</strong>, <strong>down &amp; up</strong>.</p>
<p>How it works:</p>
<p>If a resource is not available, the corresponding semaphore blocks any process <strong>waiting</strong> for the resource.</p>
<p>Blocked processes are put into a process queue maintained by the semaphore (avoids busy waiting!)</p>
<p>When a process releases a resource, it <strong>signals</strong> this by means of the semaphore.</p>
<p>Signaling resumes a blocked process if there is any.</p>
<p><strong>Wait (P)</strong> and <strong>signal (V)</strong> operations <strong>cannot be interrupted</strong>.</p>
<p>Complex coordination can be implemented by multiple semaphores.</p>
<img src="/2023/04/26/3231note/10.png" class="" title="Semaphore">
<img src="/2023/04/26/3231note/11.png" class="" title="Semaphore">

<p><strong>The initial count determines how many waits can progress before blocking and requiring a signal.</strong></p>
<h3 id="Producer-Consumer-problem-with-semaphores"><a href="#Producer-Consumer-problem-with-semaphores" class="headerlink" title="Producer Consumer problem with semaphores:"></a><strong>Producer Consumer problem with semaphores:</strong></h3><img src="/2023/04/26/3231note/12.png" class="" title="Define Semaphore">

<img src="/2023/04/26/3231note/13.png" class="" title="Define Semaphore">
<h3 id="Summarising-Semaphores"><a href="#Summarising-Semaphores" class="headerlink" title="Summarising Semaphores"></a><strong>Summarising Semaphores</strong></h3><p>Semaphores can be used to solve a variety of concurrency problems.</p>
<p>However, programming with then can be error-prone:</p>
<p>E.g. <strong>must signal for every wait</strong></p>
<p>To many or too few signals or waits, or signals and waits in the wrong order, can have bad results.</p>
<h3 id="Monitor"><a href="#Monitor" class="headerlink" title="Monitor"></a><strong>Monitor</strong></h3><p>A higher level synchronisation primitive.</p>
<p>Programming language construct</p>
<p><strong>IDEA:</strong></p>
<p>A set of procedures&#x2F;variables&#x2F;data types are grouped in a special module:monitor.</p>
<p>Variables and data types can only be accessed from <strong>within the monitor</strong>.</p>
<p><strong>Only one process&#x2F;thread can be in the monitor at any one time.</strong></p>
<p>Mutual exclusion is implemented by the complier.</p>
<img src="/2023/04/26/3231note/14.png" class="" title="P44_lec03">
<p>When a thread calls a monitor procedure that has a thread already inside, it will be in the entry queue and will sleep until the current thread exits the monitor.</p>
<img src="/2023/04/26/3231note/15.png" class="" title="Monitor">
<h3 id="Condition-Variable"><a href="#Condition-Variable" class="headerlink" title="Condition Variable"></a><strong>Condition Variable</strong></h3><p>To allow a process to wait within the monitor, we need to declare a condition variable.</p>
<p>Condition variable can only be used with the operations <strong>wait</strong> and <strong>signal</strong>.</p>
<p><strong>x.wait()</strong></p>
<p>Means that the process invoking this operation is suspended until another process invokes.</p>
<p>Another thread can enter the monitor while original is suspended.</p>
<p><strong>x.signal()</strong></p>
<p>this operation resumes <strong>only one</strong> suspended process.</p>
<p>If no process is suspended, then this operation has no effect.</p>
<img src="/2023/04/26/3231note/16.png" class="" title="P49_lec03">

<p>How to achieve producer-consumer problem with monitors is in <strong>P50 lec03</strong>.</p>
<h3 id="Synchronisation-Primitives-in-OS-x2F-161"><a href="#Synchronisation-Primitives-in-OS-x2F-161" class="headerlink" title="Synchronisation Primitives in OS&#x2F;161"></a><strong>Synchronisation Primitives in OS&#x2F;161</strong></h3><h4 id="Locks"><a href="#Locks" class="headerlink" title="Locks"></a><strong>Locks</strong></h4><img src="/2023/04/26/3231note/17.png" class="" title="P53_lec03">
<h4 id="Semaphores-1"><a href="#Semaphores-1" class="headerlink" title="Semaphores"></a><strong>Semaphores</strong></h4><img src="/2023/04/26/3231note/18.png" class="" title="P55_lec03">

<p><strong>Wait (P)</strong> &#x2F; <strong>signal (V)</strong></p>
<h4 id="Condition-Variables"><a href="#Condition-Variables" class="headerlink" title="Condition Variables"></a><strong>Condition Variables</strong></h4><img src="/2023/04/26/3231note/19.png" class="" title="P56_lec03">

<p>Note: All three variants must hold the lock passed in.</p>
<h5 id="Condition-Variables-and-Bounded-Buffers"><a href="#Condition-Variables-and-Bounded-Buffers" class="headerlink" title="Condition Variables and Bounded Buffers"></a><strong>Condition Variables and Bounded Buffers</strong></h5><img src="/2023/04/26/3231note/20.png" class="" title="P57_lec03">

<p>cv_wait() will release the lock before block the process</p>
<h5 id="Producer-consumer-solution-with-condition-variable"><a href="#Producer-consumer-solution-with-condition-variable" class="headerlink" title="Producer-consumer solution with condition variable"></a><strong>Producer-consumer solution with condition variable</strong></h5><img src="/2023/04/26/3231note/21.png" class="" title="P58_lec03">

<h3 id="Dining-Philosophers"><a href="#Dining-Philosophers" class="headerlink" title="Dining Philosophers"></a><strong>Dining Philosophers</strong></h3><p>哲学家就餐问题是一个经典的计算机科学同步问题，由Edsger Dijkstra在1965年提出。问题描述了五位哲学家围坐在圆桌旁的情景，他们在思考问题和吃饭之间交替。圆桌中间有一碗意面，每两位哲学家之间有一根筷子。每位哲学家需要两根筷子才能吃饭。哲学家们不能交谈，只能思考或吃饭。</p>
<p>问题在于设计一个协议，使得每位哲学家都能够在需要时使用两根筷子吃饭，而不会出现死锁（即所有哲学家都在等待筷子，无法继续吃饭）或者饥饿（即某位哲学家长时间无法获得筷子）的情况。</p>
<p>以下是一个可能的解决方案：</p>
<p>我们可以为每根筷子分配一个编号（例如，1到5），并为每位哲学家分配一个编号。每位哲学家在需要吃饭时，先尝试拿起编号较低的筷子，然后尝试拿起编号较高的筷子。当哲学家同时拥有两根筷子时，他们可以开始吃饭。吃完饭后，他们将筷子放回原位，然后继续思考。</p>
<p>这种方法可以避免死锁，因为至少有一位哲学家（具有最低编号筷子的哲学家）可以拿起两根筷子并开始吃饭。其他哲学家则需要等待筷子被放回。虽然这种方法可能导致某些哲学家等待时间较长，但可以确保所有哲学家都有机会吃饭，避免饥饿现象。</p>
<h3 id="Reader-and-Writer-Problem"><a href="#Reader-and-Writer-Problem" class="headerlink" title="Reader and Writer Problem"></a><strong>Reader and Writer Problem</strong></h3><p>读者-写者问题是一个经典的计算机科学并发控制问题，用于描述多个进程在访问共享资源时需要进行同步的场景。在这个问题中，有一些读者进程和写者进程。读者进程只读取共享资源，而写者进程可以修改共享资源。问题的挑战在于设计一个同步协议，以允许多个读者进程同时访问共享资源，但在写者进程访问资源时，确保其他进程（读者和写者）无法访问资源。</p>
<p>以下是一个可能的解决方案：</p>
<p>我们可以使用互斥量（mutex）和信号量（semaphore）来实现这个协议。在这个解决方案中，我们需要一个互斥量来保护对共享资源的访问计数器，以及一个信号量来控制对共享资源的访问。</p>
<p>读者进程：</p>
<ol>
<li>请求互斥量以修改访问计数器。</li>
<li>将访问计数器加1。如果这是第一个读者进程，请求信号量以阻止写者进程访问共享资源。</li>
<li>释放互斥量。</li>
<li>访问共享资源。</li>
<li>请求互斥量以修改访问计数器。</li>
<li>将访问计数器减1。如果这是最后一个读者进程，释放信号量以允许写者进程访问共享资源。</li>
<li>释放互斥量。</li>
</ol>
<p>写者进程：</p>
<ol>
<li>请求信号量以阻止其他进程访问共享资源。</li>
<li>访问共享资源。</li>
<li>释放信号量以允许其他进程访问共享资源。</li>
</ol>
<p>这个解决方案允许多个读者进程同时访问共享资源，但当有写者进程需要访问资源时，它们将等待所有当前的读者进程完成。同样，在写者进程访问共享资源时，其他读者和写者进程将被阻止。这种方法可以确保在写者进程访问资源时，没有其他进程可以访问共享资源。</p>
<h2 id="Lec04-DeadLock"><a href="#Lec04-DeadLock" class="headerlink" title="Lec04 DeadLock"></a>Lec04 DeadLock</h2><h3 id="DeadLock-amp-Resources"><a href="#DeadLock-amp-Resources" class="headerlink" title="DeadLock &amp; Resources"></a><strong>DeadLock &amp; Resources</strong></h3><p>Deadlocks occurs when</p>
<ol>
<li>Processes are granted exclusive access to devices&#x2F;locks&#x2F;tables..</li>
<li>We refer to these entities generally as resources.</li>
</ol>
<p>Deadlock: definition</p>
<p><strong>A set of processes is deadlocked if each process in the set is waiting for an event that only another process in the set can cause.</strong></p>
<p>In the deadlock situation, no process can</p>
<ol>
<li>Run</li>
<li>Release resources</li>
<li>Be awakened</li>
</ol>
<h3 id="Four-conditions-for-deadlock"><a href="#Four-conditions-for-deadlock" class="headerlink" title="Four conditions for deadlock"></a><strong>Four conditions for deadlock</strong></h3><ol>
<li>Mutual exclusion condition<ol>
<li>Each resource assigned to 1 process or is available</li>
</ol>
</li>
<li>Hold and wait condition<ol>
<li>Process holding resources can request additional</li>
</ol>
</li>
<li>No preemption condition<ol>
<li>Previously granted resources cannot be forcibly taken away</li>
</ol>
</li>
<li>Circular wait	condition<ol>
<li>Must be a circular chain of 2 or more processes</li>
<li>Each is waiting for resource held by next member of the chain</li>
</ol>
</li>
</ol>
<h3 id="Deadlock-avoidance"><a href="#Deadlock-avoidance" class="headerlink" title="Deadlock avoidance"></a><strong>Deadlock avoidance</strong></h3><ol>
<li>Just ignore the problem altogether</li>
<li>Prevention 预防<ol>
<li>Negating on of the four necessary conditions</li>
</ol>
</li>
<li>Detection and recovery</li>
<li>Dynamic avoidance<ol>
<li>Careful resource allocation</li>
</ol>
</li>
</ol>
<h4 id="Method-1-Ostrich-Algorithm"><a href="#Method-1-Ostrich-Algorithm" class="headerlink" title="Method 1: Ostrich Algorithm"></a><strong>Method 1: Ostrich Algorithm</strong></h4><p>Pretend there is no problem</p>
<p>Reasonable if</p>
<ol>
<li>Deadlocks occur very rarely</li>
<li>Cost of prevention is high</li>
</ol>
<p>UNIX and Windows takes this approach for some of the more complex resource relationships they manage</p>
<p>It’s a trade off between</p>
<ol>
<li>Convenience (engineering approach)</li>
<li>Correctness (mathematical approach)</li>
</ol>
<h4 id="Method-2-Deadlock-prevention"><a href="#Method-2-Deadlock-prevention" class="headerlink" title="Method 2: Deadlock prevention"></a><strong>Method 2: Deadlock prevention</strong></h4><p>Resource allocation rules prevent deadlock by prevent one of the four conditions required for deadlock from occurring:</p>
<ol>
<li>Mutual exclusion</li>
<li>Hold and wait</li>
<li>No preemption</li>
<li>Circular Wait</li>
</ol>
<h5 id="Attacking-the-Mutual-Exclusion-Condition-Not-feasible"><a href="#Attacking-the-Mutual-Exclusion-Condition-Not-feasible" class="headerlink" title="Attacking the Mutual Exclusion Condition (Not feasible)"></a><strong>Attacking the Mutual Exclusion Condition (Not feasible)</strong></h5><p>Not feasible in general</p>
<p>Some devices&#x2F;resources are intrinsically(本质上) not sharable.</p>
<h5 id="Attacking-the-hold-and-wait-condition-request-resources-initially"><a href="#Attacking-the-hold-and-wait-condition-request-resources-initially" class="headerlink" title="Attacking the hold and wait condition (request resources initially)"></a><strong>Attacking the hold and wait condition (request resources initially)</strong></h5><p>Require processes to <strong>request resources before starting</strong></p>
<p>A process never has to wait for what it needs</p>
<p><strong>Issues</strong>:</p>
<ol>
<li>May not know required resources at start of run</li>
</ol>
<p>Which means not always possible</p>
<ol>
<li>Also ties up resources other processes could be using</li>
</ol>
<p><strong>Variations:</strong></p>
<ol>
<li>Process must give up all resources if it would block holding a resource</li>
<li>Then request all immediately need</li>
<li>Prone(倾向于) to livelock</li>
</ol>
<h5 id="Attacking-the-No-Preemption-condition-无优先权条件-take-resources-away"><a href="#Attacking-the-No-Preemption-condition-无优先权条件-take-resources-away" class="headerlink" title="Attacking the No Preemption condition(无优先权条件)(take resources away)"></a><strong>Attacking the No Preemption condition(无优先权条件)(take resources away)</strong></h5><p><strong>Not a viable option</strong></p>
<h5 id="Attacking-the-circular-wait-condition-Order-resources"><a href="#Attacking-the-circular-wait-condition-Order-resources" class="headerlink" title="Attacking the circular wait condition (Order resources)"></a><strong>Attacking the circular wait condition (Order resources)</strong></h5><p><strong><em>Numerically ordered resources</em> (Resources ordering is a common technique)</strong></p>
<h4 id="Method-3-Detection-and-recovery"><a href="#Method-3-Detection-and-recovery" class="headerlink" title="Method 3: Detection and recovery"></a><strong>Method 3: Detection and recovery</strong></h4><p>Need a method to determine if a system is deadlocked.</p>
<p>Assuming deadlocked is detected, we need a method of recovery to restore progress to the system.</p>
<h5 id="Strategy"><a href="#Strategy" class="headerlink" title="Strategy:"></a><strong>Strategy:</strong></h5><p>Note the resource ownership and requests</p>
<p>A cycle can be found within the graph, which denotes a deadlock</p>
<h5 id="Detection-with-Multiple-Resources-of-Each-Type"><a href="#Detection-with-Multiple-Resources-of-Each-Type" class="headerlink" title="Detection with Multiple Resources of Each Type"></a><strong>Detection with Multiple Resources of Each Type</strong></h5><img src="/2023/04/26/3231note/22.png" class="" title="P28_lec04">

<p><strong>Sum of current resource allocation + resources available &#x3D; resources that exist</strong></p>
<img src="/2023/04/26/3231note/23.png" class="" title="Detection">
<h6 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h6><ol>
<li>Look for an unmarked process <strong>Pi</strong>, for which the i-th row of R is less than or equal to A.</li>
<li>If found, add the i-th row of <strong>C</strong> to <strong>A</strong>, and mark <strong>Pi</strong>, then go back to step 1.</li>
<li>If no such process exists, terminate.</li>
</ol>
<p><strong>The remaining processes are deadlocked.</strong></p>
<h5 id="Recovery-from-Deadlock"><a href="#Recovery-from-Deadlock" class="headerlink" title="Recovery from Deadlock"></a><strong>Recovery from Deadlock</strong></h5><p><strong>Recovery through preemption</strong></p>
<p>• take a resource from some other process</p>
<p>• depends on nature of the resource</p>
<p><strong>Recovery through rollback</strong></p>
<p>• checkpoint a process periodically</p>
<p>• use this saved state </p>
<p>• restart the process if it is found deadlocked</p>
<p>• No guarantee is won’t deadlock again</p>
<p><strong>Recovery through killing processes</strong></p>
<p>• crudest but simplest way to break a deadlock</p>
<p>• kill one of the processes in the deadlock cycle</p>
<p>• the other processes get its resources </p>
<p>• choose process that can be rerun from the beginning</p>
<h4 id="Method-4-Deadlock-Avoidance"><a href="#Method-4-Deadlock-Avoidance" class="headerlink" title="Method 4: Deadlock Avoidance"></a><strong>Method 4: Deadlock Avoidance</strong></h4><p>Only enough information is available in advance, we can avoid a deadlock.</p>
<ol>
<li>Maximum number of each resource required</li>
</ol>
<img src="/2023/04/26/3231note/24.png" class="" title="P47_lec04">

<h5 id="Safe-and-Unsafe-states"><a href="#Safe-and-Unsafe-states" class="headerlink" title="Safe and Unsafe states"></a><strong>Safe and Unsafe states</strong></h5><p><strong>A state is safe if</strong></p>
<p>• The system is not deadlocked</p>
<p>• There exists a scheduling order that results in every process running </p>
<p>to completion, even if they all request their maximum resources </p>
<p>immediately</p>
<p><strong>Unsafe states are not necessarily deadlocked</strong></p>
<p>• With a lucky sequence, all processes may complete </p>
<p>• However, we <strong>cannot guarantee</strong> that they will complete </p>
<p>(not deadlock)</p>
<p>• <strong>Safe states guarantee we will eventually complete all processes</strong></p>
<p>•Deadlock avoidance algorithm</p>
<p>• Only grant requests that result in safe states</p>
<h3 id="LiveLock"><a href="#LiveLock" class="headerlink" title="LiveLock"></a><strong>LiveLock</strong></h3><p>Livelocked processes are not blocked, change state regularly, but never make progress</p>
<img src="/2023/04/26/3231note/25.png" class="" title="P19_lec04">
<h3 id="Bankers-Algorithm"><a href="#Bankers-Algorithm" class="headerlink" title="Bankers Algorithm"></a><strong>Bankers Algorithm</strong></h3><p>Modelled on a Banker with Customers</p>
<p>• The banker has a limited amount of money to loan customers</p>
<p>• Limited number of resources</p>
<p>• Each customer can borrow money up to the customer’s credit limit</p>
<p>• Maximum number of resources required</p>
<p>Basic Idea</p>
<p>• Keep the bank in a safe state </p>
<p>• So all customers are happy even if they all request to borrow up to their </p>
<p>credit limit at the same time.</p>
<p>• Customers wishing to borrow such that the bank would enter an unsafe state must wait until somebody else repays their loan such that the the </p>
<p>transaction becomes safe</p>
<h3 id="Starvation"><a href="#Starvation" class="headerlink" title="Starvation"></a><strong>Starvation</strong></h3><p>A process never receives the resource it is waiting for, despite the resource (repeatedly) becoming free, the resource is always allocated to another waiting process</p>
<p><strong>One Solution: First come, first server</strong></p>
<h2 id="Lec05-Processes-and-Threads-Implementation"><a href="#Lec05-Processes-and-Threads-Implementation" class="headerlink" title="Lec05 Processes and Threads Implementation"></a>Lec05 Processes and Threads Implementation</h2><h3 id="MIPS-Registers"><a href="#MIPS-Registers" class="headerlink" title="MIPS Registers"></a><strong>MIPS Registers</strong></h3><p>User-mode accessible registers</p>
<p>• 32 general purpose registers</p>
<p>• r0 hardwired to zero</p>
<p>• r31 the link register for jump-and-link </p>
<p>(JAL) instruction</p>
<p>HI&#x2F;LO </p>
<p>• 2 * 32-bits for multiply and divide</p>
<p>PC </p>
<p>• Not directly visible</p>
<p>• Modified implicitly by jump and branch instructions</p>
<h3 id="Branching-and-Jumping"><a href="#Branching-and-Jumping" class="headerlink" title="Branching and Jumping"></a><strong>Branching and Jumping</strong></h3><p>Branching and jumping have a branch delay slot</p>
<p>• <strong>The instruction following a branch or jump is always executed prior to destination of jump</strong></p>
<h3 id="Process"><a href="#Process" class="headerlink" title="Process"></a><strong>Process</strong></h3><h4 id="Memory-allocation"><a href="#Memory-allocation" class="headerlink" title="Memory allocation"></a><strong>Memory allocation</strong></h4><p>Minimally consist of three segments</p>
<p>• Text</p>
<p>• contains the code (instructions)</p>
<p>• Data</p>
<p>• Global variables</p>
<p>• Stack</p>
<p>• Activation records of procedure&#x2F;function&#x2F;method</p>
<p>• Local variables </p>
<p>Note:</p>
<p>• data can dynamically grow up</p>
<p>• E.g., malloc()-ing</p>
<p>• The stack can dynamically grow down</p>
<p>• E.g., increasing function call depth or recursion</p>
<img src="/2023/04/26/3231note/26.png" class="" title="P23_lec05"> P23 lec05

<h4 id="Mode-distinguish"><a href="#Mode-distinguish" class="headerlink" title="Mode distinguish"></a><strong>Mode distinguish</strong></h4><p><strong>User-mode</strong></p>
<p>• Processes (programs) scheduled by the kernel</p>
<p>• Isolated from each other</p>
<p>• <strong>No concurrency issues between each other</strong></p>
<p><strong>System-calls transition into and return from the kernel</strong></p>
<p><strong>Kernel-mode</strong></p>
<p>• Nearly all activities still associated with a process</p>
<p>• Kernel memory shared between all processes</p>
<p>• Concurrency issues exist between processes concurrently executing in a system call</p>
<h3 id="User-level-Threads"><a href="#User-level-Threads" class="headerlink" title="User-level Threads"></a><strong>User-level Threads</strong></h3><img src="/2023/04/26/3231note/27.png" class="" title="P32_lec05">

<p><strong>Implementation at user-level</strong></p>
<p>• User-level Thread Control Block (TCB), ready queue, blocked queue, and dispatcher</p>
<p>• Kernel has no knowledge of the threads (it only sees a single process)</p>
<p>• If a thread blocks waiting for a resource held by another thread inside </p>
<p>the same process, its state is saved and the dispatcher switches to another ready thread</p>
<p>• Thread management (create, exit, yield, wait) are implemented in a runtime support library</p>
<h4 id="Pros"><a href="#Pros" class="headerlink" title="Pros"></a><strong>Pros</strong></h4><p>• Thread management and switching <strong>at user level is much faster than doing it in kernel level</strong></p>
<p>• No need to trap (take syscall exception) into kernel and back to switch</p>
<p>• Dispatcher algorithm can be tuned to the application</p>
<p>• E.g. use priorities</p>
<p>• Can be implemented on any OS (thread or non-thread aware)</p>
<p>• Can easily support massive numbers of threads on a per-application </p>
<p>basis</p>
<p>• Use normal application virtual memory</p>
<p>• Kernel memory more constrained. Difficult to efficiently support wildly differing numbers of threads for different applications</p>
<h4 id="Cons"><a href="#Cons" class="headerlink" title="Cons"></a><strong>Cons</strong></h4><p>• Threads have to yield() manually (<strong>no timer interrupt delivery to user level</strong>)</p>
<p>• <strong>Co-operative multithreading</strong></p>
<p>• A single poorly design&#x2F;implemented thread can monopolise the available CPU time</p>
<p>• There are work-arounds (e.g. a timer signal per second to enable pre-emptive multithreading), they are course grain and a kludge.</p>
<p>• Does not take advantage of multiple CPUs (in reality, we still have a single threaded process as far as the kernel is concerned)</p>
<p>• If a thread makes a blocking system call (or takes a page fault), the process (and all the internal threads) blocks</p>
<p>• Can’t overlap I&#x2F;O with computation</p>
<h3 id="Kernel-provided-Threads"><a href="#Kernel-provided-Threads" class="headerlink" title="Kernel-provided Threads"></a><strong>Kernel-provided Threads</strong></h3><img src="/2023/04/26/3231note/28.png" class="" title="P38_lec05">

<p><strong>Threads are implemented by the kernel</strong></p>
<p>• TCBs (thread control block) are stored in the kernel</p>
<p>• A subset of information in a traditional PCB (process control block)</p>
<p>• The subset related to execution context</p>
<p>• TCBs have a PCB associated with them</p>
<p>• Resources associated with the group of threads (the process)</p>
<p>• Thread management calls are implemented as system calls</p>
<p>• E.g. create, wait, exit</p>
<h4 id="Cons-1"><a href="#Cons-1" class="headerlink" title="Cons"></a><strong>Cons</strong></h4><p>• Thread creation and destruction, and blocking and unblocking threads requires kernel entry and exit.</p>
<p>• More expensive than user-level equivalent</p>
<h4 id="Pros-1"><a href="#Pros-1" class="headerlink" title="Pros"></a><strong>Pros</strong></h4><p>• Preemptive multithreading</p>
<p>• Parallelism</p>
<p>• Can overlap blocking I&#x2F;O with computation</p>
<p>• <strong>Can take advantage of a multiprocessor</strong></p>
<h3 id="Context-Switch"><a href="#Context-Switch" class="headerlink" title="Context Switch"></a><strong>Context Switch</strong></h3><p><strong>Context Switch is what the lowest level of OS does when an interrupt occurs.</strong></p>
<p>A context switch can refer to</p>
<p>• A switch between threads</p>
<p>• Involving saving and restoring of state associated with a thread</p>
<p>• A switch between processes</p>
<p>• Involving the above, plus extra state associated with a process. </p>
<p>• E.g. memory maps</p>
<h4 id="Context-Switch-Occurrence"><a href="#Context-Switch-Occurrence" class="headerlink" title="Context Switch Occurrence"></a><strong>Context Switch Occurrence</strong></h4><p>A switch between process&#x2F;threads can happen any time the OS is invoked</p>
<p>• On a system call</p>
<p>• Mandatory if system call blocks or on exit();</p>
<p>• On an exception</p>
<p>• Mandatory if offender is killed</p>
<p>• On an interrupt</p>
<p>• Triggering a dispatch is the main purpose of the timer interrupt</p>
<p><strong>A thread switch can happen between any two instructions</strong></p>
<p>Note <strong>instructions do not equal program statements</strong></p>
<h3 id="Context-Switch-Addition"><a href="#Context-Switch-Addition" class="headerlink" title="Context Switch Addition"></a><strong>Context Switch Addition</strong></h3><ul>
<li>Context switch must be transparent for processes&#x2F;threads</li>
</ul>
<p>• When dispatched again, process&#x2F;thread should not notice that something else was running in the meantime (except for elapsed time)</p>
<ol>
<li>OS must save all state that affects the thread</li>
</ol>
<p>• This state is called the process&#x2F;thread context</p>
<p>• Switching between process&#x2F;threads consequently </p>
<p>results in a context switch.</p>
<h2 id="Lec06-Syscalls"><a href="#Lec06-Syscalls" class="headerlink" title="Lec06 Syscalls"></a>Lec06 Syscalls</h2><h3 id="Syscall-Definition"><a href="#Syscall-Definition" class="headerlink" title="Syscall Definition"></a><strong>Syscall Definition</strong></h3><p>Can be viewed as special function calls</p>
<p>• Provides for a controlled entry into the kernel</p>
<p>• While in kernel, they perform a privileged operation</p>
<p>• Returns to original caller with the result</p>
<p>The system call interface represents the abstract machine provided by the operating system.</p>
<h3 id="CPU-Computation-Model"><a href="#CPU-Computation-Model" class="headerlink" title="CPU Computation Model"></a><strong>CPU Computation Model</strong></h3><p>The fetch-execute cycle</p>
<p>• Load memory contents from address in program counter (PC)</p>
<p>• The instruction</p>
<p>• Execute the instruction</p>
<p>• Increment PC</p>
<p>• Repeat</p>
<img src="/2023/04/26/3231note/29.png" class="" title="P12_lec06">
<h3 id="Privileged-mode-operation"><a href="#Privileged-mode-operation" class="headerlink" title="Privileged-mode operation"></a><strong>Privileged-mode operation</strong></h3><p>To protect operating system execution, two or more CPU modes of operation exist</p>
<p>• Privileged mode (system-, kernel-mode)</p>
<p>• <strong>All instructions and registers are available</strong></p>
<p>• User-mode</p>
<p>• Uses ‘safe’ subset of the instruction set </p>
<p>• Only affects the state of the application itself </p>
<p>• They cannot be used to uncontrollably interfere with OS</p>
<p>• <strong>Only ‘safe’ registers are accessible</strong></p>
<p>The accessibility of addresses within an address space changes depending on operating mode</p>
<p>• To protect kernel code and data</p>
<p>• Note: The exact memory ranges are usually configurable, and vary between CPU architectures and&#x2F;or operating systems.</p>
<img src="/2023/04/26/3231note/30.png" class="" title="P16_lec06">

<p><strong>System call mechanism securely transfers from user execution to kernel execution and back.</strong></p>
<h3 id="System-call-mechanism-overview"><a href="#System-call-mechanism-overview" class="headerlink" title="System call mechanism overview"></a><strong>System call mechanism overview</strong></h3><p>• Processor mode</p>
<p>• Switched from user-mode to kernel-mode</p>
<p>• Switched back when returning to user mode</p>
<p>• Stack Pointer (SP)</p>
<p>• User-level SP is saved and a kernel SP is initialised</p>
<p>• User-level SP restored when returning to user-mode</p>
<p>• Program Counter (PC)</p>
<p>• User-level PC is saved and PC set to kernel entry point</p>
<p>• User-level PC restored when returning to user-level</p>
<p>• <strong>Kernel entry via the designated entry point must be strictly enforced</strong></p>
<p>•Registers</p>
<p>• Set at user-level to indicate system call type and its arguments</p>
<p>• A convention between applications and the kernel</p>
<p>• Some registers are preserved at user-level or kernel-level in order to restart user-level execution</p>
<p>• Depends on language calling convention etc.</p>
<p>• Result of system call placed in registers when returning to user-level</p>
<p>• Another convention</p>
<p>We need system calls because function calls do not:</p>
<ol>
<li>Change from user to kernel mode&#x2F;back again</li>
<li>Restrict possible entry points to secure locations</li>
</ol>
<h3 id="Coprocessor-0-CP0"><a href="#Coprocessor-0-CP0" class="headerlink" title="Coprocessor 0 (CP0)"></a><strong>Coprocessor 0 (CP0)</strong></h3><p>The processor control registers are located in CP0</p>
<ol>
<li>Exception&#x2F;Interrupt management registers</li>
<li>Translation management registers</li>
</ol>
<h4 id="Exception-management"><a href="#Exception-management" class="headerlink" title="Exception management"></a><strong>Exception management</strong></h4><img src="/2023/04/26/3231note/31.png" class="" title="P26_lec06">
<h4 id="C0-status"><a href="#C0-status" class="headerlink" title="C0_status"></a><strong>C0_status</strong></h4><p>We only focus on 0-15 bits</p>
<img src="/2023/04/26/3231note/32.png" class="" title="P28_lec06">
<h4 id="·c0-cause"><a href="#·c0-cause" class="headerlink" title="·c0_cause"></a><strong>·c0_cause</strong></h4><p>The 2<sup>nd</sup>-6<sup>th</sup> bit is for ExcCode -&gt; The code number of the exception taken</p>
<h4 id="C0-epc"><a href="#C0-epc" class="headerlink" title="C0_epc"></a><strong>C0_epc</strong></h4><p>The <strong>Exception Program Counter</strong></p>
<p>• Points to address of where to restart execution after handling the exception or interrupt</p>
<h3 id="Hardware-Exception-handling"><a href="#Hardware-Exception-handling" class="headerlink" title="Hardware Exception handling"></a><strong>Hardware Exception handling</strong></h3><p>Basic situation: Assume an interrupt occurred as the previous instruction completed &amp; We are in user mode with interrupts enabled.</p>
<p>Steps:</p>
<ol>
<li>Instruction address at which to restart after the interrupt is transferred to EPC</li>
<li>Interrupts disabled and previous state shifted along<ol>
<li>What stored in IEc&#x2F;KUc is now in IEp&#x2F;KUp</li>
<li><strong>Kernel mode is set</strong>, and previous state shifted along<ol>
<li>What stored in IEp&#x2F;KUp (before 2 a) executed) is now in IEo&#x2F;KUo</li>
</ol>
</li>
</ol>
</li>
<li>Code for the exception placed in Cause -&gt; ExcCode in c0_cause is now 0 (0 is the code for interrupt)</li>
<li>Address of general exception vector placed in PC</li>
<li>CPU now running in kernel mode at the address in PC, with interrupt disabled<ol>
<li>All information required to<ol>
<li>Find out what caused the exception</li>
<li>Restart after exception handling</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>Is in coprocessor registers</p>
<ol>
<li>(Ignore how the OS handles the exception)</li>
<li>Load the contents of EPC</li>
<li>Store the EPC back in the PC</li>
<li>In the branch delay slot (happens when we jump back to the PC&#x2F;user mode), execute a restore from exception instruction -&gt; move back KU&#x2F;IE</li>
<li>Now back in the same state we were when the exception happened</li>
</ol>
<h3 id="MIPS-System-Calls"><a href="#MIPS-System-Calls" class="headerlink" title="MIPS System Calls"></a><strong>MIPS System Calls</strong></h3><p>• System calls are invoked via a syscall instruction.</p>
<p>• The syscall instruction causes an exception and transfers control to the general exception handler</p>
<p>• A convention (an agreement between the kernel and </p>
<p>applications) is required as to how user-level software </p>
<p>indicates </p>
<p>• Which system call is required </p>
<p>• Where its arguments are</p>
<p>• Where the result should go</p>
<h3 id="OS-x2F-161-Systems-Calls"><a href="#OS-x2F-161-Systems-Calls" class="headerlink" title="OS&#x2F;161 Systems Calls"></a><strong>OS&#x2F;161 Systems Calls</strong></h3><p>OS&#x2F;161 uses the following conventions:</p>
<p>• Arguments are passed and returned via the normal C function calling convention</p>
<p>• Additionally</p>
<p>• Reg v0 contains the system call number</p>
<p>• <strong>On return, reg a3 contains</strong></p>
<p><strong>• 0: if success, v0 contains successful result</strong> </p>
<p>• not 0: if failure, v0 has the errno. </p>
<p>• v0 stored in errno</p>
<p>• -1 returned in v0</p>
<h3 id="Summary-of-System-Call-in-User-Mode"><a href="#Summary-of-System-Call-in-User-Mode" class="headerlink" title="Summary of System Call in User Mode"></a><strong>Summary of System Call in User Mode</strong></h3><p>• From the caller’s perspective, the read() system call behaves like a normal function call</p>
<p>• It preserves the calling convention of the language</p>
<p>•However, the actual function implements its own convention by agreement with the kernel</p>
<p>• Our OS&#x2F;161 example assumes the kernel preserves appropriate registers(s0-s8, sp, gp, ra).</p>
<p>•Most languages have similar libraries that interface with the operating system.</p>
<h3 id="System-Calls-–-Kernel-Side"><a href="#System-Calls-–-Kernel-Side" class="headerlink" title="System Calls – Kernel Side"></a><strong>System Calls – Kernel Side</strong></h3><p>• Things left to do</p>
<p>• Change to kernel stack</p>
<p>• Preserve registers by saving to memory (on the kernel stack)</p>
<p>• Leave saved registers somewhere accessible to</p>
<p>• Read arguments</p>
<p>• Store return values</p>
<p>• Do the “read()”</p>
<p>• Restore registers</p>
<p>• Switch back to user stack</p>
<p>• Return to application</p>
<h2 id="Lec07-Computer-Hardware-Review"><a href="#Lec07-Computer-Hardware-Review" class="headerlink" title="Lec07 Computer Hardware Review"></a>Lec07 Computer Hardware Review</h2><h3 id="Memory-Hierarchy"><a href="#Memory-Hierarchy" class="headerlink" title="Memory Hierarchy"></a><strong>Memory Hierarchy</strong></h3><img src="/2023/04/26/3231note/33.png" class="" title="P4 lec07">
<h3 id="Cashing"><a href="#Cashing" class="headerlink" title="Cashing"></a><strong>Cashing</strong></h3><p>•Given two-levels of data storage: small and fast, versus large and slow,</p>
<p>• Can speed access to slower storage by using intermediate-speed storage as a cache.</p>
<h4 id="CPU-cache"><a href="#CPU-cache" class="headerlink" title="CPU cache"></a><strong>CPU cache</strong></h4><img src="/2023/04/26/3231note/34.png" class="" title="P7 lec07">

<p>• CPU cache is fast memory placed between the CPU and main memory </p>
<p>• 1 to a few cycles access time compared to RAM access time of tens – hundreds of cycles</p>
<p>• <strong>Holds recently used data or instructions to save memory accesses.</strong></p>
<p>• <strong>Matches slow RAM access time to CPU speed if high hit rate</strong></p>
<p>• Is hardware maintained and (mostly) transparent to software</p>
<p>• Sizes range from few kB to tens of MB.</p>
<p>• Usually a hierarchy of caches (2–5 levels), on- and off-chip</p>
<h4 id="Performance"><a href="#Performance" class="headerlink" title="Performance"></a><strong>Performance</strong></h4><p>The performance depends on the hit rate in the first level.</p>
<h4 id="Effective-Access-Time"><a href="#Effective-Access-Time" class="headerlink" title="Effective Access Time"></a><strong>Effective Access Time</strong></h4><img src="/2023/04/26/3231note/35.png" class="" title="P9 lec07">
<h4 id="Avoid-Waiting-for-Disk-Access"><a href="#Avoid-Waiting-for-Disk-Access" class="headerlink" title="Avoid Waiting for Disk Access"></a><strong>Avoid Waiting for Disk Access</strong></h4><p>• Keep a subset of the disk’s data in main memory</p>
<ol>
<li>OS uses main memory as a cache of disk contents</li>
</ol>
<h4 id="Avoid-Waiting-for-Internet-Access"><a href="#Avoid-Waiting-for-Internet-Access" class="headerlink" title="Avoid Waiting for Internet Access"></a><strong>Avoid Waiting for Internet Access</strong></h4><p>• Keep a subset of the Internet’s data on disk</p>
<ol>
<li>Application uses disk as a cache of the internet</li>
</ol>
<h2 id="Lec08-File-Management"><a href="#Lec08-File-Management" class="headerlink" title="Lec08 File Management"></a>Lec08 File Management</h2><h3 id="File-Names"><a href="#File-Names" class="headerlink" title="File Names"></a><strong>File Names</strong></h3><p>File system must provide a convenient naming scheme</p>
<p>• Textual Names</p>
<p>• May have restrictions</p>
<p>• Only certain characters</p>
<p>• E.g. no ‘&#x2F;’ characters</p>
<p>• Limited length</p>
<p>• Only certain format </p>
<p>• E.g DOS, 8 + 3</p>
<p>• Case (in)sensitive</p>
<p>• Names may obey conventions (.c files for C files)</p>
<p>• Interpreted by tools (e.g. UNIX)</p>
<p>• Interpreted by operating system (e.g. Windows “con:”)</p>
<h3 id="File-Structure"><a href="#File-Structure" class="headerlink" title="File Structure"></a><strong>File Structure</strong></h3><p>• Sequence of Bytes</p>
<p>• OS considers a file to be unstructured</p>
<p>• Applications can impose their own structure</p>
<p>• Used by UNIX, Windows, most modern OSes</p>
<img src="/2023/04/26/3231note/36.png" class="" title="P9 lec08">P9 lec08
<h3 id="File-Types"><a href="#File-Types" class="headerlink" title="File Types"></a><strong>File Types</strong></h3><p>• Regular files</p>
<p>•Directories</p>
<p>•Device Files</p>
<p>–May be divided into</p>
<p>•Character Devices – stream of bytes</p>
<p>•Block Devices</p>
<p>•Some systems distinguish between regular file types</p>
<p>–ASCII text files, binary files</p>
<h3 id="File-Access-Types-Patterns"><a href="#File-Access-Types-Patterns" class="headerlink" title="File Access Types (Patterns)"></a><strong>File Access Types (Patterns)</strong></h3><p>•Sequential access 顺序读写</p>
<p>–read all bytes&#x2F;records from the beginning</p>
<p>–cannot jump around, could rewind or back up</p>
<p>–<strong>convenient when medium was magnetic tape</strong></p>
<p>•Random access 随机读写</p>
<p>–bytes&#x2F;records read in any order</p>
<p>–<strong>essential for data base systems</strong></p>
<p>–read can be …</p>
<p>•move file pointer (seek), then read or</p>
<p>–lseek(location,…);read(…)</p>
<p>•each read specifies the file pointer</p>
<p>–read(location,…)</p>
<h3 id="Typical-File-Operations"><a href="#Typical-File-Operations" class="headerlink" title="Typical File Operations"></a><strong>Typical File Operations</strong></h3><ol>
<li>Create</li>
<li>Delete</li>
<li>Open</li>
<li>Close</li>
<li>Read</li>
<li>Write</li>
<li>Append</li>
<li>Seek</li>
<li>Get attributes</li>
<li>Set Attribute</li>
<li>Rename</li>
</ol>
<h3 id="Criteria-for-File-Organization"><a href="#Criteria-for-File-Organization" class="headerlink" title="Criteria for File Organization"></a><strong>Criteria for File Organization</strong></h3><p>Things to consider when designing file layout</p>
<p>•Rapid access</p>
<p>–Needed when accessing a single record</p>
<p>–Not needed for batch mode</p>
<p>•read from start to finish</p>
<p>•Ease of update</p>
<p>–File on CD-ROM will not be updated, so this is not a concern</p>
<p>•Economy of storage</p>
<p>–Should be minimum redundancy in the data</p>
<p>–Redundancy can be used to speed access such as an index</p>
<h3 id="File-Directories"><a href="#File-Directories" class="headerlink" title="File Directories"></a><strong>File Directories</strong></h3><p>•Provide <strong>mapping between file names and the files themselves</strong></p>
<p>•Contain information about files</p>
<p>–Attributes</p>
<p>–Location</p>
<p>–Ownership</p>
<p>•<strong>Directory itself is a file owned by the operating system</strong></p>
<h3 id="Hierarchical-Tree-Structured-Directory"><a href="#Hierarchical-Tree-Structured-Directory" class="headerlink" title="Hierarchical (Tree Structured) Directory"></a><strong>Hierarchical (Tree Structured) Directory</strong></h3><p>•Files can be located by following a path from the root, or master, directory down various branches</p>
<p>–This is the absolute pathname for the file</p>
<p>•<strong>Can have several files with the same file name as long as they have unique path names(同一路径下的文件名不得相等)</strong></p>
<h3 id="Relative-and-Absolute-Pathnames"><a href="#Relative-and-Absolute-Pathnames" class="headerlink" title="Relative and Absolute Pathnames"></a><strong>Relative and Absolute Pathnames</strong></h3><p>•Absolute pathname</p>
<p>–A path specified <strong>from the root of the file system to the file</strong></p>
<p>A Relative pathname</p>
<p>–A pathname specified from the cwd (current working directory)</p>
<h3 id="Typical-Directory-Operations"><a href="#Typical-Directory-Operations" class="headerlink" title="Typical Directory Operations"></a><strong>Typical Directory Operations</strong></h3><ol>
<li>Create</li>
<li>Delete</li>
<li>Opendir</li>
<li>Closedir</li>
<li>Readdir</li>
<li>Rename</li>
<li>Link</li>
<li>Unlink</li>
</ol>
<h3 id="Nice-Properties-of-UNIX-naming"><a href="#Nice-Properties-of-UNIX-naming" class="headerlink" title="Nice Properties of UNIX naming"></a><strong>Nice Properties of UNIX naming</strong></h3><p>•Simple, regular format</p>
<p>–Names referring to different servers, objects, etc., <strong>have the same syntax</strong>.</p>
<p>•Regular tools can be used where specialised tools would be otherwise be needed.</p>
<p>•Location independent</p>
<p>–Objects can be distributed or migrated, and continue with the same names</p>
<h3 id="Access-Rights"><a href="#Access-Rights" class="headerlink" title="Access Rights"></a><strong>Access Rights</strong></h3><p>In multiuser system, we need to consider the issue of the access rights.</p>
<p>Different kinds of Access Rights:</p>
<ol>
<li>None<ol>
<li>User <strong>may not know the existence</strong> of the file</li>
<li>User is <strong>not allowed to read the directory</strong> that includes the file</li>
</ol>
</li>
<li>Knowledge<ol>
<li>User can <strong>only determine that the file exists and who its owner is</strong></li>
</ol>
</li>
<li>Execution<ol>
<li>The user can load and execute a program <strong>but cannot copy it</strong></li>
</ol>
</li>
<li>Reading<ol>
<li>The user can <strong>read the file for any purpose,</strong> including copying and execution</li>
</ol>
</li>
<li>Appending<ol>
<li>The user can add data to the file but cannot modify or delete any of the file’s contents</li>
</ol>
</li>
<li>Updating<ol>
<li>The user can <strong>modify, delete, and add</strong> to the file’s data. This includes <strong>creating the file, rewriting it, and removing all or part</strong> of the data</li>
</ol>
</li>
<li>Changing protection<ol>
<li>User can <strong>change access rights</strong> granted to other users</li>
</ol>
</li>
<li>Deletion<ol>
<li>User can delete the file</li>
</ol>
</li>
<li>Owners<ol>
<li><strong>Has all rights previously listed</strong></li>
<li>May grant rights to others using the following classes of users<ol>
<li>•Specific user</li>
<li>•User groups</li>
<li>•All for public files</li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="Simultaneous-Access"><a href="#Simultaneous-Access" class="headerlink" title="Simultaneous Access"></a><strong>Simultaneous Access</strong></h3><p>In multiuser system, we need to consider the issue of the simultaneous access.</p>
<p>•Most OSes provide mechanisms for users to manage concurrent access to files</p>
<p>–Example: flock(), lockf(), system calls</p>
<p>•Typically</p>
<p>–User may <strong>lock entire file</strong> when it is to be updated</p>
<p>–User may <strong>lock the individual records</strong> (i.e. ranges) during the update</p>
<p>•<strong>Mutual exclusion and deadlock are issues</strong> for shared access</p>
<h2 id="Lec09-File-System-Internals"><a href="#Lec09-File-System-Internals" class="headerlink" title="Lec09 File System Internals"></a>Lec09 File System Internals</h2><h3 id="UNIX-Storage-Stack"><a href="#UNIX-Storage-Stack" class="headerlink" title="UNIX Storage Stack"></a><strong>UNIX Storage Stack</strong></h3><p>From lower to Higher:</p>
<ol>
<li>Hard disk platters:<ol>
<li>Tracks</li>
<li>Sectors</li>
</ol>
</li>
<li>Disk controller<ol>
<li>Hides disk geometry, bad sectors</li>
<li>Exposes linear sequence of blocks(disk’s interface)</li>
</ol>
</li>
<li>Device driver<ol>
<li>Hides device-specific protocol</li>
<li>Exposes block-device interface</li>
</ol>
</li>
<li>Disk scheduler&#x2F;buffer cache -&gt; Optimisations<ol>
<li>Keep recently accessed disk blocks in memory</li>
<li>Schedule disk accesses from multiple processes for performance and fairness</li>
</ol>
</li>
<li>File System<ol>
<li>Hides physical location of data on the disk</li>
<li>Exposes:<ol>
<li>Directory hierarchy 目录的层次结构</li>
<li>Symbolic file names</li>
<li>Random-access files</li>
<li>Protrction</li>
</ol>
</li>
</ol>
</li>
<li>Virtual File System (VFS)<ol>
<li>Unified interface to multiple File systems</li>
</ol>
</li>
<li>Open File Table (OF table)&#x2F;File Descriptor Table (FD table)<ol>
<li>Keep track of files opened by user-level processes</li>
<li>Matches syscall interface to VFS interface</li>
</ol>
</li>
</ol>
<img src="/2023/04/26/3231note/37.png" class="" title="P10 lec09">
<h3 id="Difference-between-some-FS"><a href="#Difference-between-some-FS" class="headerlink" title="Difference between some FS"></a><strong>Difference between some FS</strong></h3><p><strong>Different physical nature of storage devices</strong></p>
<p>– Ext3 is optimised for magnetic disks</p>
<p>– JFFS2 is optimised for flash memory devices</p>
<p>– ISO9660 is optimised for CDROM</p>
<p><strong>Different storage capacities</strong></p>
<p>– FAT16 does not support drives &gt;2GB</p>
<p>– FAT32 becomes inefficient on drives &gt;32GB</p>
<p>– ZFS, Btrfs is designed to scale to multi-TB disk arrays</p>
<p><strong>Different CPU and memory requirements</strong></p>
<p>– FAT16 is not suitable for modern PCs but is a good fit for many embedded devices</p>
<p><strong>Proprietary standards</strong></p>
<p>– NTFS may be a nice FS, but its specification is closed</p>
<h3 id="Property-of-hard-disk"><a href="#Property-of-hard-disk" class="headerlink" title="Property of hard disk"></a><strong>Property of hard disk</strong></h3><p>– Seek time</p>
<p>• ~15ms worst case</p>
<p>– Rotational delay</p>
<p>• 8ms worst case for 7200rpm drive</p>
<p>– For comparison, disk-to-buffer transfer speed of a modern drive is ~10µs per 4K block</p>
<p>Conclusion: <strong>keep blocks that are likely to be accessed together close to each other</strong></p>
<h3 id="Implementing-a-file-system"><a href="#Implementing-a-file-system" class="headerlink" title="Implementing a file system"></a><strong>Implementing a file system</strong></h3><h4 id="Requirements"><a href="#Requirements" class="headerlink" title="Requirements"></a><strong>Requirements</strong></h4><p>The FS must map symbolic file names into a collection of block addresses.</p>
<p>The FS must keep track of</p>
<p>– which blocks belong to which files.</p>
<p>– in what order the blocks form the file</p>
<p>– which blocks are free for allocation</p>
<p><strong>Given a logical region of a file, the FS must track the corresponding block(s) on disk.</strong></p>
<img src="/2023/04/26/3231note/38.png" class="" title="P16 lec09">
<h4 id="File-Allocation-Methods"><a href="#File-Allocation-Methods" class="headerlink" title="File Allocation Methods"></a><strong>File Allocation Methods</strong></h4><h5 id="Contiguous-Allocation"><a href="#Contiguous-Allocation" class="headerlink" title="Contiguous Allocation"></a><strong>Contiguous Allocation</strong></h5><p>✔ <strong>Easy bookkeeping</strong> (need to keep track of the starting block and length of the file)</p>
<p>✔ Increases performance for <strong>sequential operations</strong></p>
<p>✗ <strong>Need the maximum size for the file</strong> at the time of creation</p>
<p>✗ As files are deleted, free space becomes divided into many small chunks (<strong>external fragmentation</strong>)</p>
<p>Example: ISO 9660 (CDROM)</p>
<img src="/2023/04/26/3231note/39.png" class="" title="P18 lec09">

<h5 id="Dynamic-Allocation-Strategies"><a href="#Dynamic-Allocation-Strategies" class="headerlink" title="Dynamic Allocation Strategies"></a><strong>Dynamic Allocation Strategies</strong></h5><p>– Disk space allocated in portions as needed</p>
<p>– Allocation occurs in fixed-size blocks</p>
<p>✔ <strong>No external fragmentation</strong></p>
<p>✔ Does not require pre-allocating disk space</p>
<p>✗ Partially filled blocks (<strong>internal fragmentation</strong>)</p>
<p>✗ File blocks are scattered across the disk</p>
<p>✗ Complex metadata management (maintain the collection of blocks </p>
<p>for each file)</p>
<img src="/2023/04/26/3231note/40.png" class="" title="P19 lec09">

<p>Examples come after:</p>
<ol>
<li><a href="#_dynamic_allocation_:">Linked list allocation</a></li>
<li><a href="#_dynamic_allocation:_file">File Allocation Table (FAT)</a></li>
<li><a href="#_dynamical_allocation:_inode-based">Inode-based FS structure</a></li>
</ol>
<h3 id="External-and-Internal-fragmentation"><a href="#External-and-Internal-fragmentation" class="headerlink" title="External and Internal fragmentation"></a><strong>External and Internal fragmentation</strong></h3><h4 id="External-fragmentation"><a href="#External-fragmentation" class="headerlink" title="External fragmentation"></a><strong>External fragmentation</strong></h4><p>– The space wasted <strong>external to the allocated memory regions</strong></p>
<p>– Memory space exists to satisfy a request but it is unusable as it is not contiguous</p>
<h4 id="Internal-fragmentation"><a href="#Internal-fragmentation" class="headerlink" title="Internal fragmentation"></a><strong>Internal fragmentation</strong></h4><p>– The space wasted internal to the allocated memory regions</p>
<p>– <strong>Allocated memory may be slightly larger than requested memory</strong>; this <strong>size difference is wasted memory internal to a partition</strong></p>
<h4 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a><strong>Conclusion</strong></h4><p>Internal fragmentation is inside the allocated memory blocks</p>
<p>External fragmentation is between two allocated memory blocks</p>
<h3 id="Dynamic-allocation-Linked-list-allocation"><a href="#Dynamic-allocation-Linked-list-allocation" class="headerlink" title="Dynamic allocation : Linked list allocation"></a><a name="_dynamic_allocation_:"></a><strong>Dynamic allocation : Linked list allocation</strong></h3><p>Each block contains the block number of the next block in the chain. Free blocks are also linked in a chain.</p>
<p>✔ Only single metadata entry per file</p>
<p>✔ <strong>Best for sequentially accessed files</strong></p>
<p>✗ <strong>Poor for random access</strong></p>
<p>✗ Blocks end up scattered across the disk due to free list <strong>eventually being randomised</strong></p>
<img src="/2023/04/26/3231note/41.png" class="" title="P21 lec09">
<h3 id="Dynamic-Allocation-File-allocation-Table-FAT"><a href="#Dynamic-Allocation-File-allocation-Table-FAT" class="headerlink" title="Dynamic Allocation: File allocation Table (FAT)"></a><a name="_dynamic_allocation:_file"></a><strong>Dynamic Allocation: File allocation Table (FAT)</strong></h3><p>• Keep a map of the entire FS in a separate table</p>
<p>– A table entry contains the number of the next block of the file</p>
<p>– The last block in a file and empty blocks are marked using reserved values</p>
<p>• The table is stored on the disk and is replicated in memory</p>
<p>• <strong>Random access is fast</strong> (following the in-memory list)</p>
<p>Issues:</p>
<p>Requires a lot of memory for large disks</p>
<h4 id="File-allocation-table-disk-layout"><a href="#File-allocation-table-disk-layout" class="headerlink" title="File allocation table disk layout"></a><strong>File allocation table disk layout</strong></h4><img src="/2023/04/26/3231note/42.png" class="" title="P25 lec09">
<h3 id="Dynamical-Allocation-inode-based-FS-structure"><a href="#Dynamical-Allocation-inode-based-FS-structure" class="headerlink" title="Dynamical Allocation: inode-based FS structure"></a><a name="_dynamical_allocation:_inode-based"></a><strong>Dynamical Allocation: inode-based FS structure</strong></h3><p>Idea: separate table (index-node or i-node) for each file.</p>
<p>– Only keep table for open files in memory</p>
<p>– <strong>Fast random access</strong></p>
<p><strong>The most popular FS structure today</strong></p>
<img src="/2023/04/26/3231note/43.png" class="" title="P26 lec09">
<h4 id="Issues-1"><a href="#Issues-1" class="headerlink" title="Issues:"></a><strong>Issues:</strong></h4><ol>
<li>i-nodes occupy one or several disk areas</li>
<li>i-nodes are <strong>allocated dynamically</strong>, hence <strong>free-space management</strong> is required for i-nodes<ol>
<li>– Use fixed-size i-nodes to simplify dynamic allocation</li>
<li>– Reserve the last i-node entry for a pointer (a block number) to an extension i-node</li>
</ol>
</li>
</ol>
<img src="/2023/04/26/3231note/44.png" class="" title="P28 lec09">

<ol>
<li>Free-space management<ol>
<li>Approach 1: Linked list of free blocks in free blocks on disk</li>
<li>Keep bitmaps of free blocks and free i-nodes on disk</li>
</ol>
</li>
</ol>
<img src="/2023/04/26/3231note/45.png" class="" title="P29 lec09">

<h5 id="Free-block-List"><a href="#Free-block-List" class="headerlink" title="Free block List"></a><strong>Free block List</strong></h5><p>List of all unallocated blocks</p>
<p>Background jobs can re-order list for better contiguity</p>
<p>Store in free blocks themselves</p>
<p>– <strong>Does not reduce disk capacity</strong></p>
<p>Only one block of pointers need be kept in the main memory</p>
<h5 id="Bit-tables"><a href="#Bit-tables" class="headerlink" title="Bit tables"></a><strong>Bit tables</strong></h5><p>Individual bits in a bit vector flags used&#x2F;free blocks</p>
<p>16GB disk with 512-byte blocks –&gt; 4MB table</p>
<p><strong>May be too large to hold in main memory</strong></p>
<p>Expensive to search</p>
<p>– Optimisations possible, e.g. a two level table</p>
<p>Concentrating (de)allocations in a portion of the bitmap has desirable effect of concentrating access</p>
<p>Simple to find contiguous free space</p>
<h3 id="Implementing-directories"><a href="#Implementing-directories" class="headerlink" title="Implementing directories"></a><strong>Implementing directories</strong></h3><p>• <strong>Directories are stored like normal files</strong></p>
<p>– directory entries are contained inside data blocks</p>
<p>• The FS assigns special meaning to the content of these files</p>
<p>– a directory file is <strong>a list of directory entries</strong></p>
<p>– a directory entry contains file name, attributes, and the file i-node number</p>
<p>• maps human-oriented file name to a system-oriented name</p>
<h3 id="Fixed-size-directory-entries"><a href="#Fixed-size-directory-entries" class="headerlink" title="Fixed-size directory entries"></a><strong>Fixed-size directory entries</strong></h3><p>– Either too small</p>
<p>• Example: DOS 8+3 characters</p>
<p>– Or waste too much space</p>
<p>• Example: 255 characters per file name</p>
<h3 id="Variable-size-directory-entries"><a href="#Variable-size-directory-entries" class="headerlink" title="Variable-size directory entries"></a><strong>Variable-size directory entries</strong></h3><p>– Freeing variable length entries can <strong>create external fragmentation</strong> in directory blocks</p>
<p>• Can compact when block is in RAM</p>
<h3 id="Searching-Directory-methods"><a href="#Searching-Directory-methods" class="headerlink" title="Searching Directory methods"></a><strong>Searching Directory methods</strong></h3><ol>
<li>Linear scan<ol>
<li>Implement a directory cache in software to speed-up search</li>
</ol>
</li>
<li>Hash lookup</li>
<li>B-tree</li>
</ol>
<h3 id="Storing-file-attributes"><a href="#Storing-file-attributes" class="headerlink" title="Storing file attributes"></a><strong>Storing file attributes</strong></h3><ol>
<li>Disk addresses and attributes in directory entry -&gt; FAT</li>
<li>Directory in which each entry just refers to an i-node -&gt; UNIX</li>
</ol>
<img src="/2023/04/26/3231note/46.png" class="" title="P35 lec09">
<h3 id="File-system-block-size"><a href="#File-system-block-size" class="headerlink" title="File system block size"></a><strong>File system block size</strong></h3><p>File systems deal with 2 types of blocks</p>
<p>– Disk blocks or sectors (usually 512 bytes)</p>
<p>– File system blocks 512 * 2^N bytes</p>
<p>What should N be will be the problem.</p>
<p>• <strong>Smaller blocks</strong> waste less disk space (<strong>less internal fragmentation</strong>)</p>
<p>• Sequential Access</p>
<p>– The larger the block size, the fewer I&#x2F;O operations required</p>
<p>• Random Access</p>
<p>– The larger the block size, the more unrelated data loaded.</p>
<p>– Spatial locality of access improves the situation</p>
<p>• Choosing an appropriate block size is a compromise</p>
<h2 id="Lec10-UNIX-File-Management-continue"><a href="#Lec10-UNIX-File-Management-continue" class="headerlink" title="Lec10 UNIX File Management (continue)"></a>Lec10 UNIX File Management (continue)</h2><h3 id="Virtual-file-system-VFS"><a href="#Virtual-file-system-VFS" class="headerlink" title="Virtual file system (VFS)"></a><strong>Virtual file system (VFS)</strong></h3><p>Traversing the directory hierarchy may require VFS to issue requests to several underlying file systems.</p>
<p>• Provides <strong>single system call interface for many file systems</strong></p>
<p>– E.g., UFS, Ext2, XFS, DOS, ISO9660,…</p>
<p>• Transparent handling of network file systems</p>
<p>– E.g., NFS, AFS, CODA</p>
<p>• File-based interface to arbitrary device drivers (&#x2F;dev)</p>
<p>• File-based interface to kernel data structures (&#x2F;proc)</p>
<p>• <strong>Provides an indirection layer for system calls</strong></p>
<p>– File operation table set up at file open time</p>
<p>– Points to actual handling code for particular type</p>
<p>– Further file operations redirected to those functions</p>
<img src="/2023/04/26/3231note/47.png" class="" title="P9 lec10">
<h3 id="Data-Types-in-VFS-Interface"><a href="#Data-Types-in-VFS-Interface" class="headerlink" title="Data Types in VFS Interface"></a><strong>Data Types in VFS Interface</strong></h3><h4 id="VFS"><a href="#VFS" class="headerlink" title="VFS"></a><strong>VFS</strong></h4><ol>
<li>Represent all file system types</li>
<li>Contains pointers to functions to manipulate each file system as a whole<ol>
<li><strong>Form a standard interface to the file system</strong></li>
</ol>
</li>
</ol>
<h4 id="Vnode"><a href="#Vnode" class="headerlink" title="Vnode"></a><strong>Vnode</strong></h4><ol>
<li>Represents a file (inode) in the underlying filesystem</li>
<li>Points to the real inode</li>
<li>Contains pointers to funcions to manipulate files&#x2F;inodes like open&#x2F;close&#x2F;read</li>
</ol>
<h3 id="File-descriptors"><a href="#File-descriptors" class="headerlink" title="File descriptors"></a><strong>File descriptors</strong></h3><h4 id="Attributes"><a href="#Attributes" class="headerlink" title="Attributes"></a><strong>Attributes</strong></h4><ol>
<li>Each open file has a file descriptor</li>
<li>Read&#x2F;Write&#x2F;Lseek&#x2F;… use them to specify which file to operate on.</li>
</ol>
<h4 id="State-associated-with-a-file-descriptor"><a href="#State-associated-with-a-file-descriptor" class="headerlink" title="State associated with a file descriptor"></a><strong>State associated with a file descriptor</strong></h4><ol>
<li>File pointer<ol>
<li>Determine where in the file the next read or write is performed</li>
</ol>
</li>
<li>Mode<ol>
<li>Was the file opened with read-only permission or sth…</li>
</ol>
</li>
</ol>
<h3 id="Use-single-fd-table-with-no-of-table"><a href="#Use-single-fd-table-with-no-of-table" class="headerlink" title="Use single fd table with no of table"></a><strong>Use single fd table with no of table</strong></h3><p>How to achieve:</p>
<p>Use vnode numbers as file descriptors and add a file pointer to the vnode.</p>
<p>Problem:</p>
<p><code>	</code><strong>Cannot handling concurrency situations</strong>.</p>
<img src="/2023/04/26/3231note/48.png" class="" title="P23 lec10">

<p>At this situation:</p>
<ol>
<li>we only have a single global open file array.</li>
<li>Entries contains file pointer and a pointer to a vnode.</li>
</ol>
<p>Issues:</p>
<p>File descriptor 1 is stdout -&gt; console for some processes but may be a file for other processes</p>
<p><strong>Entry 1 should be different different per process!</strong></p>
<h3 id="Per-process-File-descriptor-array"><a href="#Per-process-File-descriptor-array" class="headerlink" title="Per-process File descriptor array"></a><strong>Per-process File descriptor array</strong></h3><img src="/2023/04/26/3231note/49.png" class="" title="P25 lec10">

<p><strong>Each process has its own open file array</strong></p>
<h4 id="Issue"><a href="#Issue" class="headerlink" title="Issue"></a><strong>Issue</strong></h4><ol>
<li>Fork<ol>
<li>Fork defines that the child <strong>shares the file pointer</strong> with the parent</li>
</ol>
</li>
<li>Dup2<ol>
<li>Also defines the file descriptors share the file pointer</li>
</ol>
</li>
<li>With per-process table, we can <strong>only have independent file pointers</strong>, even when accessing the same file</li>
</ol>
<h3 id="Per-Process-fd-table-with-global-open-file-table"><a href="#Per-Process-fd-table-with-global-open-file-table" class="headerlink" title="Per-Process fd table with global open file table"></a><strong>Per-Process fd table with global open file table</strong></h3><img src="/2023/04/26/3231note/50.png" class="" title="P27 lec10">

<p>Per-process file descriptor array <strong>contains pointers to <em>open file table entry</em></strong></p>
<p>Open file table array <strong>contains entries with a file pointer and a pointer to an vnode</strong>.</p>
<p>This model provides</p>
<ol>
<li>Shared file pointers if required</li>
<li>Independent file pointers if required</li>
</ol>
<p><strong>This model used by linux and most other UNIX operating systems</strong></p>
<h3 id="Buffer"><a href="#Buffer" class="headerlink" title="Buffer"></a><strong>Buffer</strong></h3><p>–Temporary storage used when <strong>transferring data between two entities</strong></p>
<p>•Especially when the entities work at different rates</p>
<p>•Or when the unit of transfer is incompatible</p>
<p>•Example: between application program and disk</p>
<h4 id="Buffer-disk-blocks"><a href="#Buffer-disk-blocks" class="headerlink" title="Buffer disk blocks"></a><strong>Buffer disk blocks</strong></h4><p>•Allow applications to <strong>work with arbitrarily sized region of a file</strong></p>
<p>–However, apps can still optimise for a particular block size</p>
<p>•Writes can return immediately after copying to kernel buffer</p>
<p>–<strong>Avoids waiting</strong> until write to disk is complete</p>
<p>–Write is <strong>scheduled in the background</strong></p>
<p>•Can implement read-ahead by pre-loading next block on disk into kernel buffer</p>
<p>–Avoids having to wait until next read is issued</p>
<h3 id="Cache"><a href="#Cache" class="headerlink" title="Cache"></a><strong>Cache</strong></h3><p>Fast storage used to temporarily hold data to speed up repeated access to the data -&gt; such as main memory can cache disk blocks</p>
<p>•On access</p>
<p>–Before loading block from disk, check if it is in cache first</p>
<p>•<strong>Avoids disk accesses</strong></p>
<p>•Can optimise for repeated access for single or several processes</p>
<h3 id="Buffer-and-caching-are-related"><a href="#Buffer-and-caching-are-related" class="headerlink" title="Buffer and caching are related"></a><strong>Buffer and caching are related</strong></h3><p>•Data is read into buffer; an extra independent </p>
<p>cache copy would be wasteful</p>
<p>•<strong>After use, block should be cached</strong></p>
<p>•Future access may hit cached copy</p>
<p>•Cache utilises unused kernel memory space; </p>
<p>–may have to shrink, depending on memory demand</p>
<h3 id="Cache-replacement"><a href="#Cache-replacement" class="headerlink" title="Cache replacement"></a><strong>Cache replacement</strong></h3><p>When the buffer cache is full and we need to read another block into memory, we must choose an existing entry to replace</p>
<p>Policies:</p>
<ol>
<li>FIFO (first in first out)</li>
<li>Least recently used</li>
</ol>
<p>Etc.</p>
<h3 id="File-system-consistency"><a href="#File-system-consistency" class="headerlink" title="File system consistency"></a><strong>File system consistency</strong></h3><p>Generally, cached disk blocks are prioritised in terms of how critical they are to file system consistency.</p>
<p>–<strong>Directory blocks, inode blocks</strong> if lost can corrupt entire filesystem</p>
<p>•These blocks are usually scheduled for <strong>immediate write to disk</strong></p>
<p>–<strong>Data blocks if lost corrupt only the file</strong> that they are associated with </p>
<p>•These blocks <strong>are only scheduled for write back to disk periodically</strong> </p>
<p>•In UNIX, flushd (flush daemon) flushes all modified blocks to disk every 30 seconds</p>
<h4 id="Possible-Solution"><a href="#Possible-Solution" class="headerlink" title="Possible Solution"></a><strong>Possible Solution</strong></h4><p>Write-through cache</p>
<ol>
<li>All modified blocks are <strong>written immediately to disk</strong></li>
</ol>
<p>But this will <strong>generate more disk traffic</strong></p>
<p>Works in the following situations:</p>
<ol>
<li>Floppies were removed from drives</li>
<li>Users were constantly resetting (or crashing) their machines</li>
</ol>
<p>This method is still be used in USB storage.</p>
<h2 id="Lec11-ext2-FS"><a href="#Lec11-ext2-FS" class="headerlink" title="Lec11 ext2 FS"></a>Lec11 ext2 FS</h2><h3 id="Descriptions"><a href="#Descriptions" class="headerlink" title="Descriptions:"></a><strong>Descriptions:</strong></h3><p>• Second Extended Filesystem</p>
<p>– The main Linux FS before ext3</p>
<p>– Evolved from Minix filesystem (via “Extended Filesystem”)</p>
<p>• Features</p>
<p>– Block size (1024, 2048, and 4096) configured at FS creation</p>
<p>– <strong>inode-based FS</strong></p>
<p>– Performance optimisations to improve locality (from BSD FFS)</p>
<p>• Main Problem: <strong>unclean unmount</strong> -&gt; e2fsck</p>
<p>– Ext3fs keeps a journal of (meta-data) updates</p>
<p>– Journal is a file where updates are logged</p>
<p>– Compatible with ext2fs</p>
<h3 id="i-node"><a href="#i-node" class="headerlink" title="i-node"></a><strong>i-node</strong></h3><p>• Each file is represented by an inode on disk</p>
<p>• Inode <strong>contains the fundamental file metadata</strong></p>
<p>– Access rights, owner, accounting info</p>
<p>– (partial) block index table of a file</p>
<p>• <strong>Each inode has a unique number</strong></p>
<p>– System oriented name</p>
<p>• Directories map file names to inode numbers</p>
<p>– Map human-oriented to system-oriented names</p>
<h4 id="Inode-contents"><a href="#Inode-contents" class="headerlink" title="Inode contents"></a><strong>Inode contents</strong></h4><ol>
<li>Mode<ol>
<li>Type<ol>
<li>Regular file or directory</li>
</ol>
</li>
<li>Access mode<ol>
<li>Rwxrwxrwx</li>
</ol>
</li>
</ol>
</li>
<li>Uid<ol>
<li>User ID</li>
</ol>
</li>
<li>Gid<ol>
<li>Group ID</li>
</ol>
</li>
<li>Atime<ol>
<li>Time of last access</li>
</ol>
</li>
<li>Ctime<ol>
<li>Time when the file was created</li>
</ol>
</li>
<li>Mtime<ol>
<li>Time when file was modified</li>
</ol>
</li>
<li>Size<ol>
<li>Offset of the highest byte written</li>
</ol>
</li>
<li>Block count<ol>
<li>Number of disk blocks used by the file</li>
<li>Note that number of blocks can be much less than exected given the file size</li>
</ol>
</li>
</ol>
<p>IMPORTANT:</p>
<p><code>	</code><strong>Files can be sparsely populated.</strong></p>
<p><code>	</code>Such as using lseek. the blocks between them might be empty.</p>
<p><code>	</code>So the size is not the same as the block count.</p>
<ol>
<li>Direct Blocks<ol>
<li>Block numbers of the first 12 blocks in the file</li>
<li>Most files are small<ol>
<li>We can find block of file directly from the inode.</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>For larger files, we store the data blocks’ offsets greater than 12 blocks in single&#x2F;double&#x2F;triple indirect.</p>
<ol>
<li>Single indirect<ol>
<li>Requires two disk access to read<ol>
<li>One for the indirect block, one for the target block.</li>
</ol>
</li>
<li>Max file size<ol>
<li>Assume 1K byte block size, 4 byte block numbers<ol>
<li>12 * 1K + 1K&#x2F;4 * 1K &#x3D; 268 KiB</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>So for large majority of files (&lt;268KiB), <strong>given the inode, only one or two further accesses required</strong> to read any block in file.</p>
<ol>
<li>Double indirect<ol>
<li>–Block number of a block containing block numbers of blocks containing block numbers -&gt; the second level is also block numbers of blocks, the third level has the block numbers</li>
</ol>
</li>
<li>Triple indirect<ol>
<li>Block number of a block containing block numbers of blocks containing block numbers of blocks containing block numbers</li>
</ol>
</li>
</ol>
<img src="/2023/04/26/3231note/51.png" class="" title="P16 lec11">

<img src="/2023/04/26/3231note/52.png" class="" title="P17 lec11">
<h3 id="Max-File-Size"><a href="#Max-File-Size" class="headerlink" title="Max File Size"></a><strong>Max File Size</strong></h3><p>Assume 4 bytes block numbers and 1K blocks</p>
<p>• The number of addressable blocks</p>
<p>– Direct Blocks &#x3D; 12</p>
<p>– Single Indirect Blocks &#x3D; 256</p>
<p>– Double Indirect Blocks &#x3D; 256 * 256 &#x3D; 65536</p>
<p>– Triple Indirect Blocks &#x3D; 256 * 256 * 256 &#x3D; 16777216</p>
<p>• Max File Size</p>
<p>12 + 256 + 65536 + 16777216 &#x3D; 16843020 blocks ≈ 16 GB</p>
<p>Example:</p>
<p>• Assume 4K blocks, 4 byte block numbers, 12 direct blocks</p>
<p>what if we add</p>
<p>– lseek(fd, 5242880, SEEK_SET) &#x2F;* 5 megabytes *&#x2F; </p>
<p>– write(fd, “x”, 1)</p>
<img src="/2023/04/26/3231note/53.png" class="" title="P24 lec11">

<p>Address &#x3D; 5242880 &#x3D;&#x3D;&gt; </p>
<p>Block number &#x3D; 5242880&#x2F;4096 &#x3D;1280</p>
<p>Double indirect offset (20-bit)</p>
<p>&#x3D; 1280 – 1036</p>
<p>&#x3D; 244</p>
<p>Top 10 bits &#x3D; 0 -&gt; first level block’s 0<sup>th</sup> entry</p>
<p>Lower 10 bits &#x3D; 244-&gt; second level block 244<sup>th</sup> entry</p>
<h3 id="Best-and-worse-case-access-patterns"><a href="#Best-and-worse-case-access-patterns" class="headerlink" title="Best and worse case access patterns"></a><strong>Best and worse case access patterns</strong></h3><p>Assume inode already in memory</p>
<p>To read 1 byte</p>
<p>– Best:</p>
<p>• 1 access via direct block</p>
<p>– Worst:</p>
<p>• 4 accesses via the triple indirect block</p>
<p>To write 1 byte</p>
<p>– Best:</p>
<p>• 1 write via direct block (with no previous content)</p>
<p>– Worst:</p>
<p>• 4 reads (to get previous contents of block via triple indirect) + 1 write (to write modified block back)</p>
<h3 id="Worst-Case-Access-Patterns-with-Unallocated-Indirect-Blocks"><a href="#Worst-Case-Access-Patterns-with-Unallocated-Indirect-Blocks" class="headerlink" title="Worst Case Access Patterns with Unallocated Indirect Blocks"></a><strong>Worst Case Access Patterns with Unallocated Indirect Blocks</strong></h3><p>• Worst to write 1 byte</p>
<p>– 4 writes (3 indirect blocks; 1 data)</p>
<ul>
<li>All indirect are new</li>
</ul>
<p>– 1 read, 4 writes (read-write 1 indirect, write 2; write 1 data)</p>
<ul>
<li>First indirect has something</li>
</ul>
<p>– 2 reads, 3 writes (read 1 indirect, read-write 1 indirect, write 1; write 1 data)</p>
<ul>
<li>First and second indirect have something</li>
</ul>
<p>– 3 reads, 2 writes (read 2, read-write 1; write 1 data)</p>
<ul>
<li>All three indirect have something</li>
</ul>
<p>• Worst to read 1 byte</p>
<p>– If reading writes a zero-filled block on disk</p>
<p>– Worst case is same as write 1 byte</p>
<p>– If not, worst-case depends on how deep is the current indirect block tree.</p>
<h3 id="Inode-Summary"><a href="#Inode-Summary" class="headerlink" title="Inode Summary"></a><strong>Inode Summary</strong></h3><p>The inode (and indirect blocks) contains the on-disk metadata associated with a file</p>
<p>– Contains mode, owner, and other bookkeeping</p>
<p>– Efficient random and sequential access via indexed allocation</p>
<p>– Small files (the majority of files) require only a single access</p>
<p>– Larger files require progressively more disk accesses for random access</p>
<p>• Sequential access is still efficient</p>
<p>– Can support really large files via increasing levels of indirection</p>
<h3 id="System-V-Disk-Layout-s5fs"><a href="#System-V-Disk-Layout-s5fs" class="headerlink" title="System V Disk Layout (s5fs)"></a><strong>System V Disk Layout (s5fs)</strong></h3><img src="/2023/04/26/3231note/54.png" class="" title="P31 lec11">

<p>– Boot Block</p>
<p>• contain code to bootstrap the OS</p>
<p>– Super Block</p>
<p>• Contains attributes of the file system itself</p>
<p>• e.g. size, number of inodes, start block of inode array, start of data block area, free inode list, free data block list</p>
<p>– Inode Array</p>
<p>– Data blocks</p>
<h4 id="Problems"><a href="#Problems" class="headerlink" title="Problems"></a><strong>Problems</strong></h4><p>• Inodes at start of disk; data blocks end</p>
<p>– Long seek times</p>
<p>• Must read inode before reading data blocks</p>
<p>• Only one superblock</p>
<p>– Corrupt the superblock and entire file system is lost</p>
<p>• Block allocation was suboptimal</p>
<p>– Consecutive free block list created at FS format time</p>
<p>• Allocation and de-allocation eventually randomises the list resulting in random allocation</p>
<p>• Inode free list also randomised over time</p>
<p>– Directory listing resulted in random inode access pattern</p>
<h3 id="Berkeley-Fast-Filesystem-FFS"><a href="#Berkeley-Fast-Filesystem-FFS" class="headerlink" title="Berkeley Fast Filesystem (FFS)"></a><strong>Berkeley Fast Filesystem (FFS)</strong></h3><p>•Historically followed s5fs</p>
<p>–Addressed many limitations with s5fs</p>
<p>–ext2fs mostly similar</p>
<h3 id="Layout-of-an-Ext2-FS"><a href="#Layout-of-an-Ext2-FS" class="headerlink" title="Layout of an Ext2 FS"></a><strong>Layout of an Ext2 FS</strong></h3><img src="/2023/04/26/3231note/55.png" class="" title="P34 lec11">

<p>•Partition:</p>
<p>–Reserved boot block,</p>
<p>–Collection of equally sized block groups</p>
<p>–All block groups have the same structure</p>
<h4 id="Layout-of-a-block-group"><a href="#Layout-of-a-block-group" class="headerlink" title="Layout of a block group"></a><strong>Layout of a block group</strong></h4><img src="/2023/04/26/3231note/56.png" class="" title="P35 lec11">

<p>•<strong>Replicated super block</strong></p>
<p>–For e2fsck</p>
<p>•<strong>Replicated Group descriptors</strong></p>
<p>•Bitmaps identify used inodes&#x2F;blocks</p>
<p>•All block groups have the same number of data blocks</p>
<p>•Advantages of this structure:</p>
<p>–Replication simplifies recovery</p>
<p>–Proximity of inode tables and data blocks (<strong>reduces seek time</strong>)</p>
<h4 id="Superblocks"><a href="#Superblocks" class="headerlink" title="Superblocks"></a><strong>Superblocks</strong></h4><p>•Size of the file system, block size and similar parameters</p>
<p>•Overall free inode and block counters</p>
<p>•Data indicating whether file system check is needed:</p>
<p>–Uncleanly unmounted</p>
<p>–Inconsistency</p>
<p>–Certain number of mounts since last check</p>
<p>–Certain time expired since last check</p>
<p>•Replicated to <strong>provide redundancy to aid recoverability</strong></p>
<h4 id="Group-Descriptors"><a href="#Group-Descriptors" class="headerlink" title="Group Descriptors"></a><strong>Group Descriptors</strong></h4><p>•Location of the bitmaps</p>
<p>•Counter for free blocks and inodes in this group</p>
<p>•Number of directories in the group</p>
<p>•Replicated to provide redundancy to aid recoverability</p>
<p>这些信息有助于文件系统定位和管理每个块组的资源。</p>
<h3 id="Performance-considerations"><a href="#Performance-considerations" class="headerlink" title="Performance considerations"></a><strong>Performance considerations</strong></h3><p>EXT2 optimisations</p>
<p>– Block groups cluster related inodes and data blocks</p>
<p>–Pre-allocation of blocks on write (up to 8 blocks)</p>
<p>•8 bits in bit tables</p>
<p>•Better contiguity when there are concurrent writes</p>
<p>–<strong>Aim to store files within a directory in the same group</strong></p>
<h3 id="Ext2-Directories"><a href="#Ext2-Directories" class="headerlink" title="Ext2 Directories"></a><strong>Ext2 Directories</strong></h3><p>•Directories are files of a special type</p>
<p>•Consider it a file of special format, managed by the kernel, that uses most of the same machinery to implement it</p>
<p>–Inodes, etc…</p>
<p>•Directories translate names to inode numbers</p>
<p>•Directory entries are of variable length</p>
<p>•Entries can be deleted in place</p>
<p>•inode &#x3D; 0</p>
<p>•Add to length of previous entry</p>
<img src="/2023/04/26/3231note/57.png" class="" title="P40 lec11">

<img src="/2023/04/26/3231note/58.png" class="" title="P41 lec11">

<p>“f1” &#x3D; inode 7</p>
<p>“file2” &#x3D; inode 43</p>
<p>“f3” &#x3D; inode 85</p>
<h3 id="Hard-Links"><a href="#Hard-Links" class="headerlink" title="Hard Links"></a><strong>Hard Links</strong></h3><p>Inodes can have more than one name -&gt; hard link</p>
<img src="/2023/04/26/3231note/59.png" class="" title="P44 lec11">
<h3 id="Reference-Count-in-inode"><a href="#Reference-Count-in-inode" class="headerlink" title="Reference Count in inode"></a><strong>Reference Count in inode</strong></h3><p><strong>Keep a reference count in the inode</strong>, so:</p>
<p>When we delete a file by name, i.e. remove the directory entry (link), the file system know when to delete the underlying inode</p>
<p>•Adding a name (directory entry) increments the count</p>
<p>•Removing a name decrements the count</p>
<p>•If the reference count &#x3D;&#x3D; 0, then we have <strong>no names for the inode</strong> (it is unreachable), we can <strong>delete the inode</strong> (underlying file or directory)</p>
<h3 id="Symbolic-links"><a href="#Symbolic-links" class="headerlink" title="Symbolic links"></a><strong>Symbolic links</strong></h3><p>• A symbolic link is a file that contains a reference to another file or directory</p>
<p>– <strong>Has its own inode and data block</strong>, which <strong>contains a</strong> <strong>path to the target file</strong></p>
<p>– Marked by a special file attribute</p>
<p>– Transparent for some operations</p>
<p>– <strong>Can point across FS boundaries -&gt; symbolic link only care about the path of the certain file, instead of the destination.</strong></p>
<h3 id="File-system-reliability"><a href="#File-system-reliability" class="headerlink" title="File system reliability"></a><strong>File system reliability</strong></h3><p>• Disk writes are buffered in RAM</p>
<p>– OS crash or power outage &#x3D;&#x3D;&gt; lost data</p>
<p>– Commit writes to disk periodically (e.g., every 30 sec)</p>
<p>– Use the <em>sync</em> command to force a FS flush</p>
<p>• FS operations are non-atomic</p>
<p>– Incomplete transaction can leave the FS in an inconsistent state</p>
<h4 id="Other-examples"><a href="#Other-examples" class="headerlink" title="Other examples"></a><strong>Other examples</strong></h4><p>• e2fsck</p>
<p>– Scans the disk after an unclean shutdown and attempts to restore FS invariants</p>
<p>• Journaling file systems</p>
<p>– Keep a journal of FS updates</p>
<p>– Before performing an atomic update sequence,</p>
<p>– write it to the journal</p>
<p>– Replay the last journal entries upon an unclean shutdown</p>
<p>– Example: ext3fs</p>
<h2 id="Lec12-ext3-FS"><a href="#Lec12-ext3-FS" class="headerlink" title="Lec12 ext3 FS"></a>Lec12 ext3 FS</h2><h3 id="Design-goals"><a href="#Design-goals" class="headerlink" title="Design goals"></a><strong>Design goals</strong></h3><p>– <strong>Add journaling capability</strong> to the ext2 FS</p>
<p>– <strong>Backward and forward compatibility</strong> with ext2</p>
<p>• Existing ext2 partitions can be mounted as ext3</p>
<p>– Leverage the proven ext2 performance</p>
<p>– Reuse most of the ext2 code base</p>
<p>– Reuse ext2 tools, including e2fsck</p>
<h3 id="The-ext3-journal"><a href="#The-ext3-journal" class="headerlink" title="The ext3 journal"></a><strong>The ext3 journal</strong></h3><h4 id="Option-1-Journal-FS-data-structure-updates"><a href="#Option-1-Journal-FS-data-structure-updates" class="headerlink" title="Option 1: Journal FS data structure updates"></a><strong>Option 1: Journal FS data structure updates</strong></h4><p>Example: </p>
<p>– <strong>Start transaction</strong></p>
<p>– Delete dir entry</p>
<p>– Delete i-node</p>
<p>– Release blocks 32, 17, 60</p>
<p>– <strong>End transaction</strong></p>
<h5 id="Conclusion-1"><a href="#Conclusion-1" class="headerlink" title="Conclusion"></a><strong>Conclusion</strong></h5><p>✔Efficient use of journal space; hence <strong>faster journaling</strong></p>
<p>✘ Individual updates are applied separately</p>
<p>✘ The journaling layer must understand FS semantics</p>
<h4 id="Option-2-Journal-disk-block-updates"><a href="#Option-2-Journal-disk-block-updates" class="headerlink" title="Option 2: Journal disk block updates"></a><strong>Option 2: Journal disk block updates</strong></h4><p>Example: </p>
<p>– <strong>Start transaction</strong></p>
<p>– Update block #n1 (contains the dir entry)</p>
<p>– Update block #n2 (i-node allocation bitmap)</p>
<p>– Update block #n3 (data block allocation bitmap)</p>
<p>– <strong>Add transaction</strong></p>
<h5 id="Conclusion-2"><a href="#Conclusion-2" class="headerlink" title="Conclusion"></a><strong>Conclusion</strong></h5><p>✗ Even a small update adds a whole block to the journal</p>
<p>✔ Multiple updates to the same block can be aggregated into a single update</p>
<p>✔ The journaling layer is FS independent (<strong>easier to implement</strong>)</p>
<p>Ext3 use this method</p>
<h3 id="Journaling-Block-Device-JBD"><a href="#Journaling-Block-Device-JBD" class="headerlink" title="Journaling Block Device (JBD)"></a><strong>Journaling Block Device (JBD)</strong></h3><img src="/2023/04/26/3231note/60.png" class="" title="P6 lec12">

<p>JBD interface</p>
<p>– Start a new transaction</p>
<p>– Update a disk block as part of a transaction</p>
<p>– Complete a transaction</p>
<p>• Completed transactions are buffered in RAM</p>
<p>– Commit: write transaction data to the journal (persistent storage)</p>
<p>• Multiple FS transactions are committed in one go</p>
<p>– Checkpoint: flush the journal to the disk </p>
<p>• Used when the journal is full or the FS is being unmounted</p>
<img src="/2023/04/26/3231note/61.png" class="" title="P6 lec12">
<h3 id="Journaling-modes"><a href="#Journaling-modes" class="headerlink" title="Journaling modes"></a><strong>Journaling modes</strong></h3><p>Ext3 supports two journaling modes</p>
<p>– Metadata+data</p>
<p>• Enforces atomicity of all FS operations</p>
<p>– Metadata journaling</p>
<p>• Metadata is journalled</p>
<p>• Data blocks are written directly to the disk</p>
<p>• Improves performance</p>
<p>• Enforces file system integrity</p>
<p>• Does not enforce atomicity of write’s</p>
<p>– New file content can be stale blocks</p>
<h3 id="JBD-conclusion"><a href="#JBD-conclusion" class="headerlink" title="JBD conclusion"></a><strong>JBD conclusion</strong></h3><p>JBD</p>
<p>• JBD can <strong>keep the journal on a block device or in a file</strong></p>
<p>– Enables compatibility with ext2 (the journal is just a normal file)</p>
<p>• JBD is independent of ext3-specific data structures</p>
<p>– Separation of concerns</p>
<p>• The FS maintains on-disk data and metadata</p>
<p>• JBD takes care of journaling</p>
<p>– Code reuse</p>
<p>• JBD can be used by any other FS that requires journaling</p>
<h2 id="Lec13-memory-Management"><a href="#Lec13-memory-Management" class="headerlink" title="Lec13 memory Management"></a>Lec13 memory Management</h2><h3 id="Fixed-Partition-Summary"><a href="#Fixed-Partition-Summary" class="headerlink" title="Fixed Partition Summary"></a><strong>Fixed Partition Summary</strong></h3><p>• Simple</p>
<p>• Easy to implement</p>
<p>•Can result in poor memory utilisation</p>
<p>• Due to internal fragmentation</p>
<p>•Used on IBM System 360 operating system (OS&#x2F;MFT)</p>
<p>• Announced 6 April, 1964</p>
<p>• Still applicable for simple embedded systems</p>
<p>• Static workload known in advance</p>
<h3 id="Dynamic-Partitioning"><a href="#Dynamic-Partitioning" class="headerlink" title="Dynamic Partitioning"></a><strong>Dynamic Partitioning</strong></h3><h4 id="Allocation"><a href="#Allocation" class="headerlink" title="Allocation"></a><strong>Allocation</strong></h4><p>•Also applicable to malloc()-like in-application allocators</p>
<p>•Given a region of memory, basic requirements are:</p>
<p>• Quickly locate a free partition satisfying the request</p>
<p>• Minimise CPU time search</p>
<p>• Minimise external fragmentation</p>
<p>• Minimise memory overhead of bookkeeping</p>
<p>• Efficiently support merging two adjacent free partitions into a larger partition</p>
<h5 id="Classic-Approach"><a href="#Classic-Approach" class="headerlink" title="Classic Approach"></a><strong>Classic Approach</strong></h5><p>Represent available memory as a linked list of available “holes” (free memory ranges).</p>
<p>• Base, size</p>
<p>• Kept in order of increasing address</p>
<p>• Simplifies merging of adjacent holes into larger holes.</p>
<p>• List nodes be stored in the “holes” themselves</p>
<h4 id="Placement"><a href="#Placement" class="headerlink" title="Placement"></a><strong>Placement</strong></h4><h5 id="First-fit-algorithm"><a href="#First-fit-algorithm" class="headerlink" title="First-fit algorithm"></a><strong>First-fit algorithm</strong></h5><p>• Scan the list for the first entry that fits</p>
<p>• If greater in size, break it into an allocated and free part</p>
<p>• Intent: Minimise amount of searching performed</p>
<p>• Aims to find a match quickly</p>
<p>• Biases allocation to one end of memory</p>
<p>• Tends to preserve larger blocks at the end of memory</p>
<h5 id="Next-fit"><a href="#Next-fit" class="headerlink" title="Next-fit"></a><strong>Next-fit</strong></h5><p>Like first-fit, except it <strong>begins its search from the point in list where the last request succeeded instead of at the beginning</strong>.</p>
<p>• (Flawed) Intuition: spread allocation more uniformly over entire memory to avoid skipping over small holes at start of memory</p>
<p>• <strong>Performs worse than first-fit</strong> as it <strong>breaks up the large free space at</strong> </p>
<p><strong>end of memory</strong></p>
<h5 id="Best-fit"><a href="#Best-fit" class="headerlink" title="Best-fit"></a><strong>Best-fit</strong></h5><p>• Chooses the block that is closest in size to the request</p>
<p>• <strong>Performs worse than first-fit</strong></p>
<p>• Has to search complete list </p>
<p>• does more work than first-fit</p>
<p>• Since smallest block is chosen for a process, <strong>the smallest amount of external fragmentation is left</strong> </p>
<p>• Create lots of unusable holes</p>
<h5 id="Worst-fit"><a href="#Worst-fit" class="headerlink" title="Worst-fit"></a><strong>Worst-fit</strong></h5><p>• Chooses the block that is <strong>largest in size</strong> (worst-fit)</p>
<p>• (whimsical) idea is to <strong>leave a usable fragment left over</strong></p>
<p>• Poor performer</p>
<p>• <strong>Has to do more work</strong> (like best fit) to <strong>search complete list</strong></p>
<p>• Does not result in significantly less fragmentation</p>
<h4 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a><strong>Summary</strong></h4><p>First-fit generally better than the others and easiest to implement</p>
<p>They are simple solutions to a still-existing OS or application service&#x2F;function –memory allocation.</p>
<p><strong>Largely have been superseded by more complex and specific allocation strategies</strong></p>
<h4 id="Compaction"><a href="#Compaction" class="headerlink" title="Compaction"></a><strong>Compaction</strong></h4><p>We can <strong>reduce external fragmentation</strong> by compaction</p>
<p>• Shuffle memory contents to place all free memory together in one large block.</p>
<p>• Only if we can relocate running programs?</p>
<p>• Pointers?</p>
<p>• Generally <strong>requires hardware support</strong></p>
<h4 id="Issues-2"><a href="#Issues-2" class="headerlink" title="Issues"></a><strong>Issues</strong></h4><p>• Relocation</p>
<p>• How does a process run in different locations in memory?</p>
<p>• Protection</p>
<p>• How do we prevent processes interfering with each other</p>
<h3 id="When-are-memory-address-bound"><a href="#When-are-memory-address-bound" class="headerlink" title="When are memory address bound?"></a><strong>When are memory address bound?</strong></h3><p>• Compile&#x2F;link time</p>
<p>• Compiler&#x2F;Linker binds the addresses</p>
<p>• Must know “run” location at compile time</p>
<p>• Recompile if location changes </p>
<p>• Load time</p>
<p>• Compiler generates relocatable code</p>
<p>• Loader binds the addresses at load time</p>
<p>• Run time</p>
<p>• Logical compile-time addresses translated to physical addresses by special hardware.</p>
<img src="/2023/04/26/3231note/62.png" class="" title="P36 lec13">
<h3 id="Hardware-Support-for-Runtime-Binding-and-Protection"><a href="#Hardware-Support-for-Runtime-Binding-and-Protection" class="headerlink" title="Hardware Support for Runtime Binding and Protection"></a><strong>Hardware Support for Runtime Binding and Protection</strong></h3><p>• For process to run using logical addresses</p>
<p>• Process expects to access addresses from zero to some limit of memory size</p>
<p><code>	</code>• Need to add an appropriate offset to its logical addresses</p>
<p>• Achieve relocation</p>
<p>• Protect memory “lower” than the process</p>
<p>• Must limit the maximum logical address the process can generate</p>
<p>• Protect memory “higher” than the process</p>
<img src="/2023/04/26/3231note/63.png" class="" title="P38 lec13">
<h3 id="Base-and-Limit-Registers"><a href="#Base-and-Limit-Registers" class="headerlink" title="Base and Limit Registers"></a><strong>Base and Limit Registers</strong></h3><p>•Also called</p>
<p>• Base and bound registers</p>
<p>• Relocation and limit registers</p>
<p>•Base and limit registers</p>
<p>• <strong>Restrict and relocate the currently active process</strong></p>
<p>• Base and limit registers must be changed at</p>
<p>• Load time</p>
<p>• Relocation (compaction time)</p>
<p>• On a context switch</p>
<h4 id="Pros-2"><a href="#Pros-2" class="headerlink" title="Pros"></a><strong>Pros</strong></h4><p>• Supports protected multi-processing (-tasking)</p>
<h4 id="Cons-2"><a href="#Cons-2" class="headerlink" title="Cons"></a><strong>Cons</strong></h4><p>• <strong>Physical memory allocation must still be contiguous</strong></p>
<p>• The entire process must be in memory</p>
<p>• Do not support partial sharing of address spaces</p>
<p>• <strong>No shared</strong> code, libraries, or data structures between processes</p>
<h3 id="Swapping"><a href="#Swapping" class="headerlink" title="Swapping"></a><strong>Swapping</strong></h3><p>• A process can be swapped <strong>temporarily out of memory to a backing store, and then brought back into memory for continued execution</strong>.</p>
<p>• Swapping involves <strong>transferring the whole process</strong></p>
<p>• Backing store – fast disk large enough to accommodate copies of all memory images for all users; must provide direct access to these memory images.</p>
<p>• Can prioritize – <strong>lower-priority process is swapped out so higher-priority process can be loaded and executed</strong>.</p>
<p>• <strong>Major part of swap time is transfer time</strong>; total transfer time is directly <strong>proportional to the amount of memory swapped</strong>.</p>
<p>• slow</p>
<img src="/2023/04/26/3231note/64.png" class="" title="P44 lec13">
<h3 id="Virtual-memory-paging"><a href="#Virtual-memory-paging" class="headerlink" title="Virtual memory-paging"></a><strong>Virtual memory-paging</strong></h3><p>• Partition physical memory into small <strong>equal sized chunks</strong></p>
<p>• Called frames</p>
<p>• Divide each process’s virtual (logical) address space into same size chunks</p>
<p>• Called pages</p>
<p>• Virtual memory addresses consist of a page number and offset within the page</p>
<p>• OS maintains a page table </p>
<p>• contains the frame location for each page</p>
<p>• Used by hardware to translate each virtual address to physical address</p>
<p>• The relation between virtual addresses and physical memory addresses is given by page table</p>
<p>• <strong>Process’s physical memory does not have to be contiguous</strong></p>
<h4 id="Paging"><a href="#Paging" class="headerlink" title="Paging"></a><strong>Paging</strong></h4><p>• <strong>No external fragmentation</strong></p>
<p>• <strong>Small internal fragmentation</strong> (in last page)</p>
<p>• <strong>Allows sharing</strong> by mapping several pages to the same frame</p>
<p>• Abstracts physical organisation</p>
<p>• Programmer only deal with virtual addresses</p>
<p>• Minimal support for logical organisation</p>
<p>• Each unit is one or more pages	</p>
<h3 id="Memory-Management-Unit-Translation-Look-aside-Buffer-x2F-TLB"><a href="#Memory-Management-Unit-Translation-Look-aside-Buffer-x2F-TLB" class="headerlink" title="Memory Management Unit (Translation Look-aside Buffer&#x2F;TLB)"></a><strong>Memory Management Unit (Translation Look-aside Buffer&#x2F;TLB)</strong></h3><img src="/2023/04/26/3231note/65.png" class="" title="P51 lec13">
<h2 id="Lec14-Virtual-memory"><a href="#Lec14-Virtual-memory" class="headerlink" title="Lec14 Virtual memory"></a>Lec14 Virtual memory</h2><h3 id="Page-based-VM"><a href="#Page-based-VM" class="headerlink" title="Page-based VM"></a><strong>Page-based VM</strong></h3><p>Virtual Memory</p>
<p>– Divided into equal sized pages</p>
<p>– A mapping is a translation between </p>
<p>• A page and a frame</p>
<p>• A page and invalid</p>
<p>– Mappings defined at runtime</p>
<p>• They can change</p>
<p>– Address space can have holes</p>
<p>– <strong>Process does not have to be contiguous in physical memory</strong></p>
<h3 id="Typical-Address-space-Layout"><a href="#Typical-Address-space-Layout" class="headerlink" title="Typical Address space Layout"></a><strong>Typical Address space Layout</strong></h3><p>• Stack region is at top, and can grow down</p>
<p>• Heap has free space to grow up</p>
<p>• Text is typically read-only</p>
<p>• Kernel is in a reserved, protected, shared region</p>
<p>• 0-th page typically not used, why? -&gt; NULL pointer</p>
<p>• A process may be only partially resident</p>
<p>– Allows OS to store individual pages on disk</p>
<p>– Saves memory for infrequently used data &amp; code</p>
<p>• What happens if we access non resident memory? -&gt; Page fault</p>
<h3 id="Page-fault"><a href="#Page-fault" class="headerlink" title="Page fault"></a><strong>Page fault</strong></h3><p>• Referencing an invalid page triggers a page fault</p>
<p>• An exception handled by the OS</p>
<p>• Broadly, two standard page fault types</p>
<p>– Illegal Address (protection error)</p>
<p>• Signal or kill the process</p>
<p>– Page not resident</p>
<p>• Get an empty frame</p>
<p>• Load page from disk</p>
<p>• Update page (translation) table (enter frame #, set valid bit, etc.</p>
<p>• Restart the faulting instruction</p>
<h3 id="Shared-Pages"><a href="#Shared-Pages" class="headerlink" title="Shared Pages"></a><strong>Shared Pages</strong></h3><h4 id="Private-code-and-data"><a href="#Private-code-and-data" class="headerlink" title="Private code and data"></a><strong>Private code and data</strong></h4><p>– Each process has own copy of code and data</p>
<p>– Code and data can appear anywhere in the address space</p>
<h4 id="Shared-code"><a href="#Shared-code" class="headerlink" title="Shared code"></a><strong>Shared code</strong></h4><p>– Single copy of code shared between all processes executing it</p>
<p>– Code must not be self modifying</p>
<p>– Code must appear at same address in all processes</p>
<h3 id="Trashing"><a href="#Trashing" class="headerlink" title="Trashing"></a><strong>Trashing</strong></h3><p>• CPU utilisation <strong>tends to increase with the degree of multiprogramming</strong></p>
<p>– <strong>number of processes in system</strong></p>
<p>• <strong>Higher degrees of multiprogramming – less memory available per process</strong></p>
<p>• Some process’s working sets may no longer fit in RAM</p>
<p>– Implies an increasing page fault rate</p>
<p>• Eventually many processes have insufficient memory</p>
<p>– Can’t always find a runnable process</p>
<p>– Decreasing CPU utilisation</p>
<p>– System become I&#x2F;O limited</p>
<ul>
<li>This is trashing</li>
</ul>
<img src="/2023/04/26/3231note/66.png" class="" title="P31 lec15">
<h3 id="Recovery-From-Thrashing"><a href="#Recovery-From-Thrashing" class="headerlink" title="Recovery From Thrashing"></a><strong>Recovery From Thrashing</strong></h3><p>In the presence of increasing page fault frequency and decreasing CPU utilisation</p>
<p>– Suspend a few processes to reduce degree of multiprogramming</p>
<p>– Resident pages of suspended processes will migrate to backing store</p>
<p>– More physical memory becomes available</p>
<p>• Less faults, faster progress for runnable processes</p>
<p>– Resume suspended processes later when memory pressure eases</p>
<h3 id="Page-Size"><a href="#Page-Size" class="headerlink" title="Page Size"></a><strong>Page Size</strong></h3><p><strong>Increasing page size</strong></p>
<p><strong>Increases internal fragmentation</strong></p>
<p>§ 		reduces adaptability to working set size</p>
<p><strong>Decreases number of pages</strong></p>
<p>Reduces size of page tables</p>
<p><strong>Increases TLB coverage</strong></p>
<p>Reduces number of TLB misses</p>
<p><strong>Increases page fault latency</strong></p>
<p>Need to read more from disk before restarting process</p>
<p><strong>Increases swapping I&#x2F;O throughput</strong></p>
<p>Small I&#x2F;O are dominated by seek&#x2F;rotation delays</p>
<p><strong>Optimal page size is a (work-load dependent) trade-off</strong></p>
<h2 id="Lec16-Multiprocessor-Systems"><a href="#Lec16-Multiprocessor-Systems" class="headerlink" title="Lec16 Multiprocessor Systems"></a>Lec16 Multiprocessor Systems</h2><h3 id="Amdahl’s-law"><a href="#Amdahl’s-law" class="headerlink" title="Amdahl’s law"></a><strong>Amdahl’s law</strong></h3><p>•Given a proportion P of a program that can be made parallel, and the remaining serial portion (1-P), speedup by using N processor</p>
<img src="/2023/04/26/3231note/67.png" class="" title="P5 lec16">
<h3 id="Bus-based-uniform-memory-access-multiprocessors"><a href="#Bus-based-uniform-memory-access-multiprocessors" class="headerlink" title="Bus-based uniform memory access multiprocessors"></a><strong>Bus-based uniform memory access multiprocessors</strong></h3><p>Simplest MP is more than one processor on a single bus connect to memory</p>
<p>• Access to all memory occurs at the same speed for all processors.</p>
<p>• Bus bandwidth becomes a bottleneck with more than just a few CPUs</p>
<img src="/2023/04/26/3231note/68.png" class="" title="P7 lec16">
<h4 id="Multiprocessor-caches"><a href="#Multiprocessor-caches" class="headerlink" title="Multiprocessor caches"></a><strong>Multiprocessor caches</strong></h4><p>Each processor has a cache to reduce its need for access to memory</p>
<p>• Hope is most accesses are to the local cache</p>
<p>• <strong>Bus bandwidth still becomes a bottleneck with many CPUs</strong></p>
<img src="/2023/04/26/3231note/69.png" class="" title="P8 lec16">
<h4 id="Cache-consistency"><a href="#Cache-consistency" class="headerlink" title="Cache consistency"></a><strong>Cache consistency</strong></h4><p>Cache consistency is usually handled by the hardware.</p>
<p>• Writes to one cache propagate to, or invalidate appropriate entries on other caches</p>
<p>• <strong>Cache transactions also consume bus bandwidth</strong></p>
<h4 id="Multi-core-Processor"><a href="#Multi-core-Processor" class="headerlink" title="Multi-core Processor"></a><strong>Multi-core Processor</strong></h4><img src="/2023/04/26/3231note/70.png" class="" title="P11 lec16">
<h4 id="Summary-1"><a href="#Summary-1" class="headerlink" title="Summary"></a><strong>Summary</strong></h4><p>With only a single shared bus, scalability can be <strong>limited by the bus bandwidth</strong> of the single bus</p>
<p>• Caching only helps so much</p>
<p>•Multiprocessors can</p>
<p>• Increase computation power beyond that available from a single CPU</p>
<p>• Share resources such as disk and memory</p>
<p>•However</p>
<p>• Assumes parallelizable workload to be effective </p>
<p>• Assumes not I&#x2F;O bound</p>
<p>• <strong>Shared buses (bus bandwidth) limits scalability</strong></p>
<p>• <strong>Can be reduced</strong> via hardware design</p>
<p>• Can be reduced by carefully crafted software behaviour</p>
<p>• Good cache locality together with limited data sharing where possible</p>
<h3 id="Each-CPU-has-its-own-OS"><a href="#Each-CPU-has-its-own-OS" class="headerlink" title="Each CPU has its own OS"></a><strong>Each CPU has its own OS</strong></h3><p>• Statically allocate physical memory to each CPU</p>
<p>• Each CPU runs its own independent OS</p>
<p>• Share peripherals</p>
<p>• Each CPU (OS) handles its processes system calls</p>
<img src="/2023/04/26/3231note/71.png" class="" title="P15 lec16">

<p>• Used in early multiprocessor systems to ‘get them going’</p>
<p>• <strong>Simpler to implement</strong></p>
<p>• <strong>Avoids CPU-based concurrency issues by not sharing</strong></p>
<p>• Scales – no shared serial sections</p>
<p>• Modern analogy, virtualisation in the cloud</p>
<h4 id="Issues-3"><a href="#Issues-3" class="headerlink" title="Issues"></a><strong>Issues</strong></h4><p>• Each processor has its own scheduling queue</p>
<p>• We can have one processor overloaded, and the rest idle</p>
<p>• Each processor has its own memory partition</p>
<p>• We can a one processor thrashing, and the others with free memory</p>
<p>• <strong>No way to move free memory from one OS to another</strong></p>
<h3 id="Symmetric-Multiprocessors-SMP"><a href="#Symmetric-Multiprocessors-SMP" class="headerlink" title="Symmetric Multiprocessors (SMP)"></a><strong>Symmetric Multiprocessors (SMP)</strong></h3><img src="/2023/04/26/3231note/72.png" class="" title="P18 lec16">

<p>• OS kernel run on all processors</p>
<p>• Load and resource are balance between all processors</p>
<p>• Including kernel execution</p>
<p>• Issue: <strong>Real concurrency in the kernel</strong></p>
<p>• Need carefully applied synchronisation primitives to avoid disaster</p>
<p>• One alternative: A single mutex that make the <strong>entire kernel a large critical section</strong></p>
<p>• <strong>Only one CPU can be in the kernel at a time</strong></p>
<p>• <strong>The “big lock” becomes a bottleneck</strong> when in-kernel processing exceeds what can be done on a single CPU</p>
<p>• Better alternative: identify largely independent parts of the kernel and <strong>make each of them their own critical section</strong></p>
<p>• <strong>Allows more parallelism in the kernel</strong></p>
<p>• Issue: Difficult task</p>
<p>• Code is mostly similar to uniprocessor code</p>
<p>• Hard part is <strong>identifying independent parts that don’t interfere with each other</strong></p>
<p>• Remember all the inter-dependencies between OS subsystems.</p>
<h3 id="Multiprocessor-synchronisation"><a href="#Multiprocessor-synchronisation" class="headerlink" title="Multiprocessor synchronisation"></a><strong>Multiprocessor synchronisation</strong></h3><p>Given we need synchronisation, how can we achieve it on a multiprocessor machine?</p>
<p>• Unlike a uniprocessor, <strong>disabling interrupts does not work.</strong> </p>
<p>• It does not prevent other CPUs from running in parallel</p>
<p>• <strong>Need special hardware support</strong></p>
<h4 id="Test-and-set"><a href="#Test-and-set" class="headerlink" title="Test and set"></a><strong>Test and set</strong></h4><p>Hardware guarantees that the instruction executes atomically on a </p>
<p>CPU.</p>
<p>• Atomically: As an indivisible unit.</p>
<p>• The instruction can not stop half way through</p>
<p><strong>• It does not work without some extra hardware support</strong></p>
<h5 id="•-A-solution"><a href="#•-A-solution" class="headerlink" title="• A solution:"></a><strong>•</strong> A solution:</h5><p>• Hardware blocks all other CPUs from accessing the bus during the TSL instruction to prevent memory accesses by any other CPU.</p>
<p>• TSL has mutually exclusive access to memory for duration of instruction</p>
<p>BUT <strong>Test-and Set is a busy-wait synchronisation primitive. -&gt; Spinlock</strong></p>
<h5 id="•-Issue"><a href="#•-Issue" class="headerlink" title="• Issue:"></a><strong>• Issue:</strong></h5><p>• Lock contention leads to spinning on the lock</p>
<p>• Spinning on a lock requires blocking the bus which slows all other CPUs down </p>
<p>• Independent of whether other CPUs need a lock or not </p>
<p>• Causes bus contention</p>
<h5 id="Caching-does-not-help-reduce-bus-contention"><a href="#Caching-does-not-help-reduce-bus-contention" class="headerlink" title="Caching does not help reduce bus contention"></a><strong>Caching does not help reduce bus contention</strong></h5><p>• Either TSL still blocks the bus</p>
<p>• Or TSL requires exclusive access to an entry in the local cache</p>
<p>• Requires invalidation of same entry in other caches, and loading entry into local cache</p>
<p>• Many CPUs performing TSL simply bounce a single exclusive entry between all caches using the bus</p>
<h5 id="Reducing-Bus-contention"><a href="#Reducing-Bus-contention" class="headerlink" title="Reducing Bus contention"></a><strong>Reducing Bus contention</strong></h5><p>• <strong>Read before TSL</strong></p>
<p>• Spin reading the lock variable waiting for it to change</p>
<p>• When it does, use TSL to acquire the lock</p>
<p>• <strong>Allows lock to be shared read-only in all caches until its released</strong> </p>
<p>• no bus traffic until actual release</p>
<p>• No race conditions, as acquisition is still with TSL.</p>
<h5 id="Benchmark"><a href="#Benchmark" class="headerlink" title="Benchmark"></a><strong>Benchmark</strong></h5><img src="/2023/04/26/3231note/73.png" class="" title="P40 lec16">

<p>• Test and set performs <strong>poorly once there is enough CPUs to cause contention(争夺) for lock</strong></p>
<p>• Expected</p>
<p>• <strong>Read before Test and Set performs better</strong></p>
<p>• <strong>Performance less than expected</strong></p>
<p>• Still significant <strong>contention on lock when CPUs notice release and all attempt acquisition</strong></p>
<p>• Critical section performance degenerates</p>
<p>• Critical section requires bus traffic to modify shared structure</p>
<p>• Lock holder competes with CPU that’s waiting as they test and set, so the lock holder is slower</p>
<p>• Slower lock holder results in more contention</p>
<h3 id="Spinning-vs-blocking-and-switching"><a href="#Spinning-vs-blocking-and-switching" class="headerlink" title="Spinning vs blocking and switching"></a><strong>Spinning vs blocking and switching</strong></h3><h4 id="Uniprocessor"><a href="#Uniprocessor" class="headerlink" title="Uniprocessor"></a><strong>Uniprocessor</strong></h4><p>• <strong>Spinning (busy-waiting) on a lock makes no sense on a uniprocessor</strong></p>
<p>• The was <strong>no other running process to release the lock</strong></p>
<p>• Blocking and (eventually) switching to the lock holder is the only sensible option.</p>
<p>•On SMP systems, the decision to spin or block is not as clear.</p>
<p>• The lock is held by another running CPU and will be freed without necessarily switching away from the requestor</p>
<img src="/2023/04/26/3231note/74.png" class="" title="P42 lec16">

<img src="/2023/04/26/3231note/75.png" class="" title="P43 lec16">
<h4 id="Multiprocessor"><a href="#Multiprocessor" class="headerlink" title="Multiprocessor"></a><strong>Multiprocessor</strong></h4><p>• Blocking and switching</p>
<p>• <strong>to another process takes time</strong></p>
<p>• Save context and restore another</p>
<p>• Cache contains current process not new process</p>
<p>• Adjusting the cache working set also takes time</p>
<p>• TLB is similar to cache</p>
<p>• Switching back when the lock is free encounters the same again</p>
<p>• <strong>Spinning wastes CPU time directly</strong></p>
<img src="/2023/04/26/3231note/76.png" class="" title="P45 lec16">

<img src="/2023/04/26/3231note/77.png" class="" title="P46 lec16">
<h4 id="Trade-off"><a href="#Trade-off" class="headerlink" title="Trade off"></a><strong>Trade off</strong></h4><p>• If lock is <strong>held for less time than the overhead of switching to and back</strong></p>
<p>ÞIt’s more <strong>efficient to spin</strong></p>
<p><strong>Spinlocks expect critical sections to be short</strong></p>
<p>No waiting for I&#x2F;O within a spinlock</p>
<p>No nesting locks within a spinlock</p>
<h3 id="Preemption-and-spinlocks"><a href="#Preemption-and-spinlocks" class="headerlink" title="Preemption and spinlocks"></a><strong>Preemption and spinlocks</strong></h3><p>• <strong>Critical sections synchronised via spinlocks are expected to be short</strong></p>
<p>• Avoid other CPUs wasting cycles spinning</p>
<p>• What happens if the spinlock holder is preempted at end of holder’s timeslice</p>
<p>• Mutual exclusion is still guaranteed</p>
<p>• Other CPUs will spin until the holder is scheduled again!!!!!</p>
<p><strong>Spinlock implementations disable interrupts</strong> in addition to acquiring locks </p>
<p>• avoids lock-holder preemption</p>
<p>• avoids spinning on a uniprocessor</p>
<h2 id="Lec17-scheduling"><a href="#Lec17-scheduling" class="headerlink" title="Lec17 scheduling"></a>Lec17 scheduling</h2><h3 id="Basic"><a href="#Basic" class="headerlink" title="Basic"></a><strong>Basic</strong></h3><p>The scheduler decides who to run next.</p>
<p>– The process of choosing is called scheduling.</p>
<p>Scheduling decisions can have a dramatic effect on the perceived performance of the system</p>
<p>– Can also affect correctness of a system with deadlines</p>
<h3 id="Application-Behaviour"><a href="#Application-Behaviour" class="headerlink" title="Application Behaviour"></a><strong>Application Behaviour</strong></h3><img src="/2023/04/26/3231note/78.png" class="" title="P7 lec17">

<ol>
<li>CPU-Bound process<ol>
<li>• Spends most of its computing</li>
<li>• Time to completion largely <strong>determined by received CPU time</strong></li>
</ol>
</li>
<li>I&#x2F;O-Bound process<ol>
<li>– Spend most of its time <strong>waiting for I&#x2F;O to complete</strong><ol>
<li>• Small bursts of CPU to process I&#x2F;O and request next I&#x2F;O</li>
</ol>
</li>
<li>– Time to completion largely <strong>determined by I&#x2F;O request time</strong></li>
</ol>
</li>
</ol>
<h4 id="Observation"><a href="#Observation" class="headerlink" title="Observation"></a><strong>Observation</strong></h4><p>• We need a mix of CPU-bound and I&#x2F;O-bound processes </p>
<p>to keep both CPU and I&#x2F;O systems busy</p>
<p>• Process can go from CPU- to I&#x2F;O-bound (or vice ersa) in different phase of execution</p>
<h4 id="Insight"><a href="#Insight" class="headerlink" title="Insight"></a><strong>Insight</strong></h4><p>• Choosing to run an I&#x2F;O-bound process delays a CPU-bound process by very little </p>
<p>• Choosing to run a CPU-bound process prior to an I&#x2F;O-bound process delays the next I&#x2F;O request significantly </p>
<p>– No overlap of I&#x2F;O waiting with computation </p>
<p>– Results in device (disk) not as busy as possible </p>
<p>Þ Generally, favour I&#x2F;O-bound processes over CPU-bound processes</p>
<h3 id="When-is-scheduling-performed"><a href="#When-is-scheduling-performed" class="headerlink" title="When is scheduling performed"></a><strong>When is scheduling performed</strong></h3><p>when a process (or thread) can <strong>no longer continue, or when an activity results in more than one ready process</strong>.</p>
<h3 id="Preemptive-versus-Non-preemptive-Scheduling-先发调度与后发调度"><a href="#Preemptive-versus-Non-preemptive-Scheduling-先发调度与后发调度" class="headerlink" title="Preemptive versus Non-preemptive Scheduling 先发调度与后发调度"></a><strong>Preemptive versus Non-preemptive Scheduling 先发调度与后发调度</strong></h3><h4 id="Non-preemptive"><a href="#Non-preemptive" class="headerlink" title="Non-preemptive"></a><strong>Non-preemptive</strong></h4><p>– Once a thread is in the running state, it continues until it completes, blocks on I&#x2F;O, or voluntarily yields the CPU</p>
<p>– A single process can monopolised the entire system</p>
<h4 id="Preemptive"><a href="#Preemptive" class="headerlink" title="Preemptive"></a><strong>Preemptive</strong></h4><p>– Current thread <strong>can be interrupted by OS</strong> and moved to ready state.</p>
<p>– Usually after a timer interrupt and process has exceeded its maximum run time</p>
<p>• <strong>Can also be as a result of higher priority process that has become ready</strong> (after I&#x2F;O interrupt). – Ensures fairer service as single thread can’t monopolise the system</p>
<p>• Requires a timer interrupt</p>
<h3 id="Categories-of-scheduling-algorithms"><a href="#Categories-of-scheduling-algorithms" class="headerlink" title="Categories of scheduling algorithms"></a><strong>Categories of scheduling algorithms</strong></h3><p>• The choice of scheduling algorithm depends on the goals of the application (or the operating system)</p>
<p>– No one algorithm suits all environments</p>
<p>• We can roughly categorise scheduling algorithms as follows</p>
<p>– Batch Systems</p>
<p>• No users directly waiting, can optimise for overall machine performance</p>
<p>– Interactive Systems</p>
<p>• Users directly waiting for their results, can optimise for users perceived performance</p>
<p>– Realtime Systems </p>
<p>• Jobs have deadlines, must schedule such that all jobs (predictably) meet their deadlines.</p>
<h3 id="Goals-of-scheduling-Algorithms"><a href="#Goals-of-scheduling-Algorithms" class="headerlink" title="Goals of scheduling Algorithms"></a><strong>Goals of scheduling Algorithms</strong></h3><h4 id="All-algorithms"><a href="#All-algorithms" class="headerlink" title="All algorithms"></a><strong>All algorithms</strong></h4><p>– Fairness</p>
<p>• Give each process a fair share of the CPU</p>
<p>– Policy Enforcement</p>
<p>• What ever policy chosen, the scheduler should ensure it is carried out</p>
<p>– Balance&#x2F;Efficiency</p>
<p>• Try to keep all parts of the system busy</p>
<h4 id="Interactive-Algorithms"><a href="#Interactive-Algorithms" class="headerlink" title="Interactive Algorithms"></a><strong>Interactive Algorithms</strong></h4><p>– <strong>Minimise response time</strong></p>
<p>• Response time is the time difference between issuing a command and getting the result</p>
<p>– E.g selecting a menu, and getting the result of that selection</p>
<p>• Response time is important to the user’s perception of the performance of the system.</p>
<p>– <strong>Provide Proportionality</strong></p>
<p>• Proportionality is the user expectation that short jobs will have a short response time, and long jobs can have a long response time.</p>
<p>• <strong>Generally, favour short jobs</strong></p>
<h4 id="Real-time-Algorithms"><a href="#Real-time-Algorithms" class="headerlink" title="Real-time Algorithms"></a><strong>Real-time Algorithms</strong></h4><p>– Must meet deadlines</p>
<p>• Each job&#x2F;task has a deadline.</p>
<p>• A missed deadline can result in data loss or catastrophic failure</p>
<p>– Aircraft control system missed deadline to apply brakes</p>
<p>– Provide Predictability</p>
<p>• For some apps, an occasional missed deadline is okay</p>
<p>– E.g. DVD decoder</p>
<p>• Predictable behaviour allows smooth DVD</p>
<h3 id="Round-Robin-Scheduling"><a href="#Round-Robin-Scheduling" class="headerlink" title="Round Robin Scheduling"></a><strong>Round Robin Scheduling</strong></h3><p>• Each process is given a timeslice to run in</p>
<p>• When the timeslice expires, the next process preempts the current process, and runs for its timeslice, and so on</p>
<p>– The preempted process is placed at the end of the queue</p>
<p>• Implemented with</p>
<p>– A ready queue</p>
<p>– A regular timer interrupt</p>
<h4 id="Pros-3"><a href="#Pros-3" class="headerlink" title="Pros"></a><strong>Pros</strong></h4><p><code> </code>– Fair, easy to implement</p>
<h4 id="Cons-3"><a href="#Cons-3" class="headerlink" title="Cons"></a><strong>Cons</strong></h4><p>– <strong>Assumes everybody is equal</strong></p>
<h4 id="Issue-how-long-should-the-timeslice-be"><a href="#Issue-how-long-should-the-timeslice-be" class="headerlink" title="Issue: how long should the timeslice be"></a><strong>Issue: how long should the timeslice be</strong></h4><p>– Too short</p>
<p>• <strong>Waste a lot of time switching between processes</strong></p>
<p>• Example: timeslice of 4ms with 1ms context switch &#x3D; 20% round robin overhead </p>
<p>– Too long</p>
<p>• <strong>System is not responsive</strong></p>
<p>• Example: timeslice of 100ms</p>
<p>– If 10 people hit “enter” key simultaneously, the last guy to run will only see progress after 1 second.</p>
<p>• Degenerates into FCFS if timeslice longer than burst length</p>
<h3 id="Priorities"><a href="#Priorities" class="headerlink" title="Priorities"></a><strong>Priorities</strong></h3><p>• Each Process (or thread) is associated with a priority</p>
<p>• Provides basic mechanism to influence a scheduler decision:</p>
<p>– <strong>Scheduler will always chooses a thread of higher priority over lower priority</strong> </p>
<p>• Priorities can be defined internally or externally</p>
<p>– Internal: e.g. I&#x2F;O bound or CPU bound</p>
<p>– External: e.g. based on importance to the user</p>
<p><strong>Priority-driven preemptively scheduled</strong></p>
<img src="/2023/04/26/3231note/79.png" class="" title="P46 lec17">

<p>Usually implemented by <strong>multiple priority queues, with round robin on each queue</strong></p>
<h4 id="Con"><a href="#Con" class="headerlink" title="Con:"></a><strong>Con:</strong></h4><p>– <strong>Low priorities can starve</strong></p>
<p>• Need to adapt priorities periodically</p>
<p>– Based on ageing or execution history</p>
<h3 id="Traditional-UNIX-scheduler"><a href="#Traditional-UNIX-scheduler" class="headerlink" title="Traditional UNIX scheduler"></a><strong>Traditional UNIX scheduler</strong></h3><p>• <strong>Two-level scheduler:</strong></p>
<p>– <strong>High-level scheduler schedules processes between memory and disk</strong></p>
<p>– <strong>Low-level scheduler is CPU scheduler</strong></p>
<p>• Based on a multi-level queue structure with round robin at each level</p>
<p>• The highest priority (lower number) is scheduled</p>
<p>• <strong>Priorities are re-calculated once per second, and re-inserted in appropriate queue</strong></p>
<p>– Avoid starvation of low priority threads</p>
<p>– Penalise CPU-bound threads</p>
<p><strong>• Priority &#x3D; CPU_usage +nice +base</strong></p>
<p>– <strong>CPU_usage</strong> &#x3D; number of clock ticks</p>
<p>• <strong>Decays over time</strong> to avoid permanently penalising the process </p>
<p>– <strong>Nice</strong> is a value given to the process by <strong>a user to permanently boost or reduce its priority</strong></p>
<p>• Reduce priority of background jobs </p>
<p>– <strong>Base</strong> is a set of hardwired, negative values used to boost priority of I&#x2F;O bound system activities</p>
<p>• Swapper, disk I&#x2F;O, Character I&#x2F;O</p>
<img src="/2023/04/26/3231note/80.png" class="" title="P47 lec17">
<h3 id="Multiprocessor-scheduling"><a href="#Multiprocessor-scheduling" class="headerlink" title="Multiprocessor scheduling"></a><strong>Multiprocessor scheduling</strong></h3><h4 id="A-single-shared-ready-queue"><a href="#A-single-shared-ready-queue" class="headerlink" title="A single shared ready queue"></a><strong>A single shared ready queue</strong></h4><p>When a CPU goes idle, it <strong>takes the highest priority process</strong> from the shared ready queue</p>
<h5 id="Pros-4"><a href="#Pros-4" class="headerlink" title="Pros"></a><strong>Pros</strong></h5><p>– Simple</p>
<p>– Automatic load balancing</p>
<h5 id="Cons-4"><a href="#Cons-4" class="headerlink" title="Cons"></a><strong>Cons</strong></h5><p>– <strong>Lock contention</strong> on the ready queue can be a major bottleneck</p>
<p>• Due to frequent scheduling or many CPUs or both</p>
<p>– Not all CPUs are equal</p>
<p>• The last CPU a process ran on is likely to have more related entries in the cache -&gt; waste time to load another process</p>
<h3 id="Affinity-scheduling"><a href="#Affinity-scheduling" class="headerlink" title="Affinity scheduling"></a><strong>Affinity scheduling</strong></h3><p>Basic Idea</p>
<p>– Try hard to <strong>run a process on the CPU it ran on last time</strong></p>
<p>• <strong>One approach: Multiple Queue Multiprocessor Scheduling</strong></p>
<h3 id="Multiple-Queue-SMP-Scheduling"><a href="#Multiple-Queue-SMP-Scheduling" class="headerlink" title="Multiple Queue SMP Scheduling"></a><strong>Multiple Queue SMP Scheduling</strong></h3><p>• <strong>Each CPU has its own ready queue</strong></p>
<p>• Coarse-grained algorithm assigns processes to CPUs</p>
<p>– Defines their affinity, and roughly balances the load</p>
<p>• The bottom-level fine-grained scheduler:</p>
<p>– Is the frequently invoked scheduler (e.g. on blocking on I&#x2F;O, a lock, or exhausting a timeslice)</p>
<p>– Runs on each CPU and selects from its own ready queue</p>
<p>• Ensures affinity</p>
<p>– If nothing is available from the local ready queue, it runs a process from another CPUs ready queue rather than go idle</p>
<p>• Termed “Work stealing</p>
<h4 id="Pros-5"><a href="#Pros-5" class="headerlink" title="Pros"></a><strong>Pros</strong></h4><p>No lock contention on per-CPU ready queues in the (hopefully) common case</p>
<p>– <strong>Load balancing to avoid idle queues</strong></p>
<p>– Automatic affinity to a single CPU for more <strong>cache friendly behaviour</strong></p>
<p>多队列 SMP 调度（Multiple Queue SMP Scheduling）是一种用于多处理器（SMP，Symmetric Multi-Processing）系统的进程调度策略。在这种策略中，每个处理器都有自己的一组独立的进程队列。这种方法旨在通过将进程分配到不同的处理器上，实现更好的负载平衡和并行性。</p>
<p>多队列 SMP 调度的主要特点如下：</p>
<ol>
<li><strong>独立的进程队列</strong>：在多队列 SMP 调度中，每个处理器都有自己的一组独立的进程队列，用于存储和管理等待执行的进程。每个处理器根据自己的队列中的进程来执行调度和分配任务。</li>
<li><strong>负载平衡</strong>：多队列 SMP 调度策略尝试在处理器之间实现负载平衡。当一个处理器的队列中的进程数量明显多于其他处理器时，系统可能会将一些进程迁移到其他处理器的队列中，以实现更好的负载平衡。</li>
<li><strong>并行性</strong>：多队列 SMP 调度充分利用了多处理器系统的并行性。通过在不同的处理器上同时执行多个进程，可以提高系统的整体性能和吞吐量。</li>
<li><strong>局部性</strong>：由于每个处理器都有自己的进程队列，多队列 SMP 调度有助于维护进程的局部性。这意味着一个进程可能会在同一个处理器上连续执行，从而提高缓存命中率和性能。</li>
</ol>
<p>然而，多队列 SMP 调度也存在一些挑战和缺点，例如在负载平衡和同步开销方面的问题。为了解决这些问题，研究人员和工程师们还提出了许多其他的多处理器调度策略，如全局队列调度、簇调度等。</p>
<p>总之，多队列 SMP 调度是一种适用于多处理器系统的进程调度策略，通过为每个处理器分配独立的进程队列来实现负载平衡和并行性。尽管存在一些挑战，但这种方法仍然是多处理器调度的一个重要方案</p>
<h4 id="Cons-5"><a href="#Cons-5" class="headerlink" title="Cons:"></a><strong>Cons:</strong></h4><ol>
<li><strong>负载平衡困难</strong>：尽管多队列 SMP 调度试图在处理器之间实现负载平衡，但在实践中，达到理想的负载平衡可能非常具有挑战性。在某些情况下，可能会出现一个或多个处理器的队列拥有大量进程，而其他处理器却处于空闲状态。这种不平衡可能导致系统资源的浪费和性能下降。</li>
<li><strong>同步和通信开销</strong>：在多队列 SMP 调度中，处理器之间可能需要频繁地进行进程迁移以实现负载平衡。这会导致同步和通信开销增加，从而降低系统性能。在具有许多处理器的系统中，同步和通信开销可能会变得非常显著。</li>
<li><strong>进程优先级管理困难</strong>：由于每个处理器都有自己的进程队列，管理不同处理器队列中的进程优先级可能变得复杂。在全局队列调度策略中，所有处理器共享一个进程队列，因此优先级管理相对更简单。</li>
<li><strong>高速缓存一致性问题</strong>：多队列 SMP 调度中的进程迁移可能会导致高速缓存一致性问题。当一个进程从一个处理器迁移到另一个处理器时，它可能需要重新填充高速缓存，这会导致性能下降。虽然多队列 SMP 调度有助于维护进程的局部性，但频繁的进程迁移可能会削弱这一优势。</li>
<li><strong>可伸缩性问题</strong>：在具有大量处理器的系统中，多队列 SMP 调度可能会遇到可伸缩性问题。随着处理器数量的增加，实现有效的负载平衡、优先级管理和同步变得更加困难。</li>
</ol>
<p>尽管存在这些弊端，多队列 SMP 调度仍然是多处理器系统中的一种有效调度策略。为了解决这些问题，研究人员和工程师们还提出了许多其他的多处理器调度策略，如全局队列调度、簇调度等。这些策略在不同方面具有各自的优缺点，因此需要根据具体应用场景和需求进行选择。</p>
<p><strong>TO BE NOTICED: NOT CONTAIN PART OF LEC 14 AND MOST PART OF LEC 15</strong></p>
</div>
        </div>
        
            <div class="kratos-copyright text-center clearfix">
                <h5 itemprop="copyrightNotice">本作品采用 <a rel="license nofollow" target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">知识共享署名-相同方式共享 4.0 国际许可协议</a> 进行许可</h5>
            </div>
        
        <footer class="kratos-entry-footer clearfix">
            
                <div class="post-like-donate text-center clearfix" id="post-like-donate">
                
                
                    <a class="share" href="javascript:;"><i class="fa fa-share-alt"></i> 分享</a>
                    <div class="share-wrap" style="display: none;">
    <div class="share-group">
        <a href="javascript:;" class="share-plain qq" onclick="share('qq');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-qq"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain qzone" onclick="share('qzone');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-star"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain weixin pop style-plain" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-weixin"></i>
            </div>
            <div class="share-int">
                <div class="qrcode" id="wechat-qr"></div>
                <p>打开微信“扫一扫”，打开网页后点击屏幕右上角分享按钮</p>
            </div>
        </a>
        <a href="javascript:;" class="share-plain weibo" onclick="share('weibo');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-weibo"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain facebook style-plain" onclick="share('facebook');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-facebook"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain twitter style-plain" onclick="share('twitter');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-twitter"></i>
            </div>
        </a>
    </div>
    <script type="text/javascript">
        $(()=>{
            new QRCode("wechat-qr", {
                text: "https://xhmkggybzwmz.github.io/2023/04/26/3231note/",
                width: 150,
                height: 150,
                correctLevel : QRCode.CorrectLevel.H
            });
        });
        function share(dest) {
            const qqBase        = "https://connect.qq.com/widget/shareqq/index.html?";
            const weiboBase     = "https://service.weibo.com/share/share.php?";
            const qzoneBase     = "https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?";
            const facebookBase  = "https://www.facebook.com/sharer/sharer.php?";
            const twitterBase   = "https://twitter.com/intent/tweet?";
            const hostUrl       = "https://xhmkggybzwmz.github.io/2023/04/26/3231note/";
            const title         = "「3231note」";
            const excerpt       = `UNSW COMP3231 23T1 notes`;
            let _URL;
            switch (dest) {
                case "qq"       : _URL = qqBase+"url="+hostUrl+"&title="+title+"&desc=&summary="+excerpt+"&site=cxpy";     break;
                case "weibo"    : _URL = weiboBase+"url="+hostUrl+"&title="+title+excerpt;                                 break;
                case "qzone"    : _URL = qzoneBase+"url="+hostUrl+"&title="+title+"&desc=&summary="+excerpt+"&site=cxpy";  break;
                case "facebook" : _URL = facebookBase+"u="+hostUrl;                                                        break;
                case "twitter"  : _URL = twitterBase+"text="+title+excerpt+"&url="+hostUrl;                                break;
            }
            window.open(_URL);
        };
    </script>
</div>
                
                </div>
            
            <div class="footer-tag clearfix">
                <div class="pull-left">
                <i class="fa fa-tags"></i>
                    <a class="tag-none-link" href="/tags/COMP3231/" rel="tag">COMP3231</a>
                </div>
                <div class="pull-date">
                    <time datetime="2023-06-04T12:40:06.900Z" itemprop="dateModified">最后编辑：2023-06-04</time>
                </div>
            </div>
        </footer>
    </div>
    
        <nav class="navigation post-navigation clearfix" role="navigation">
            
            <div class="nav-previous clearfix">
                <a title=" test for categories" href="/2023/03/21/test-for-cat/">&lt; 上一篇</a>
            </div>
            
            
            <div class="nav-next clearfix">
                <a title=" 2511note" href="/2023/06/03/2511note/">下一篇 &gt;</a>
            </div>
            
        </nav>
    
    
        <link rel="stylesheet" href="/vendors/gitalk@1.7.2/dist/gitalk.css"></script>
<div id="gitalk-container" class="post-comments lazy-load" style="padding-left:2rem; padding-right:2rem;"></div>
<script>
    var load_comm = () => {
        const init = () => {
            console.log('Gitalk loading...');
            const gitalk = new Gitalk(Object.assign({
                id: '/2023/04/26/3231note/',
                path: '/2023/04/26/3231note/'
            }, JSON.parse('{"clientID":"5f6c1e1e029fb52b7652","clientSecret":"48ba85488eff7bb997fd77d4ffb2c741c86e09ab","repo":"blog_comments","owner":"xhmkggybzwmz","admin":["xhmkggybzwmz"],"distractionFreeMode":false}')));

            gitalk.render('gitalk-container');
        }
        if (typeof Gitalk === 'undefined') {
            const src = '/vendors/gitalk@1.7.2/dist/gitalk.min.js';
            $.getScript(src, init);
        } else {
            init();
        }
    };
</script>
<noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="https://github.com/gitalk/gitalk">comments powered by Gitalk.</a></noscript>
    
</article>

        

            </section>

        

                
            

<section id="kratos-widget-area" class="col-md-4 hidden-xs hidden-sm">
    <!-- 文章和页面根据splitter来分割，没有的话就从头开始设置为sticky -->
    
    
                <aside id="krw-about" class="widget widget-kratos-about clearfix">
    <div class="photo-background"></div>
    <div class="photo-wrapper clearfix">
        <div class="photo-wrapper-tip text-center">
            <img class="about-photo" src="/images/bornya_avatar.webp" loading="lazy" decoding="auto" />
        </div>
    </div>
    <div class="textwidget">
        <p class="text-center"></p>
    </div>
    <div class="site-meta">
        <a class="meta-item" href="/archives/">
            <span class="title">
                文章
            </span>
            <span class="count">
                6
            </span>
        </a>
        <a class="meta-item" href="/categories/">
            <span class="title">
                分类
            </span>
            <span class="count">
                2
            </span>
        </a>
        <a class="meta-item" href="/tags/">
            <span class="title">
                标签
            </span>
            <span class="count">
                4
            </span>
        </a>
    </div>
</aside>
            
                    <div class="sticky-area">
                
                    <aside id="krw-toc" class="widget widget-kratos-toc clearfix toc-div-class" >
    <div class="photo-background"></div>
    <h4 class="widget-title no-after">
        <i class="fa fa-compass"></i>
        文章目录
        <span class="toc-progress-bar" role="progressbar" aria-label="阅读进度："></span>
    </h4>
    <div class="textwidget">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Lec-02-Processes-and-Threads"><span class="toc-text">Lec 02 Processes and Threads</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Processes"><span class="toc-text">Processes:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Threads"><span class="toc-text">Threads:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Process-Termination"><span class="toc-text">Process Termination</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Process-and-Thread-States"><span class="toc-text">Process and Thread States</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Running-%E2%86%92-Ready"><span class="toc-text">Running → Ready</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Running-%E2%86%92-Blocked"><span class="toc-text">Running → Blocked</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Schedular"><span class="toc-text">Schedular</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Thread-Model"><span class="toc-text">Thread Model</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Thread-Usage"><span class="toc-text">Thread Usage</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Summary-in-Threads"><span class="toc-text">Summary in Threads</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lec-03-Concurrency-and-Synchronisation"><span class="toc-text">Lec 03 Concurrency and Synchronisation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Concurrency-Example"><span class="toc-text">Concurrency Example:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Critical-Region-and-how-to-identify"><span class="toc-text">Critical Region and how to identify</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Critical-Regions-Solutions"><span class="toc-text">Critical Regions Solutions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mutual-exclusion-by-taking-turns"><span class="toc-text">Mutual exclusion by taking turns</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mutual-Exclusion-by-disabling-interrupts"><span class="toc-text">Mutual Exclusion by disabling interrupts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hardware-Support-for-mutual-exclusion"><span class="toc-text">Hardware Support for mutual exclusion</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tackling-the-busy-wait-problem"><span class="toc-text">Tackling the busy-wait problem:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Producer-Consumer-Problem-bounded-buffer-problem"><span class="toc-text">Producer-Consumer Problem(bounded buffer problem)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Issues"><span class="toc-text">Issues:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Semaphores"><span class="toc-text">Semaphores</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Producer-Consumer-problem-with-semaphores"><span class="toc-text">Producer Consumer problem with semaphores:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Summarising-Semaphores"><span class="toc-text">Summarising Semaphores</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Monitor"><span class="toc-text">Monitor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Condition-Variable"><span class="toc-text">Condition Variable</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Synchronisation-Primitives-in-OS-x2F-161"><span class="toc-text">Synchronisation Primitives in OS&#x2F;161</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Locks"><span class="toc-text">Locks</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Semaphores-1"><span class="toc-text">Semaphores</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Condition-Variables"><span class="toc-text">Condition Variables</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Condition-Variables-and-Bounded-Buffers"><span class="toc-text">Condition Variables and Bounded Buffers</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Producer-consumer-solution-with-condition-variable"><span class="toc-text">Producer-consumer solution with condition variable</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dining-Philosophers"><span class="toc-text">Dining Philosophers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reader-and-Writer-Problem"><span class="toc-text">Reader and Writer Problem</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lec04-DeadLock"><span class="toc-text">Lec04 DeadLock</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DeadLock-amp-Resources"><span class="toc-text">DeadLock &amp; Resources</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Four-conditions-for-deadlock"><span class="toc-text">Four conditions for deadlock</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Deadlock-avoidance"><span class="toc-text">Deadlock avoidance</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Method-1-Ostrich-Algorithm"><span class="toc-text">Method 1: Ostrich Algorithm</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Method-2-Deadlock-prevention"><span class="toc-text">Method 2: Deadlock prevention</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Attacking-the-Mutual-Exclusion-Condition-Not-feasible"><span class="toc-text">Attacking the Mutual Exclusion Condition (Not feasible)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Attacking-the-hold-and-wait-condition-request-resources-initially"><span class="toc-text">Attacking the hold and wait condition (request resources initially)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Attacking-the-No-Preemption-condition-%E6%97%A0%E4%BC%98%E5%85%88%E6%9D%83%E6%9D%A1%E4%BB%B6-take-resources-away"><span class="toc-text">Attacking the No Preemption condition(无优先权条件)(take resources away)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Attacking-the-circular-wait-condition-Order-resources"><span class="toc-text">Attacking the circular wait condition (Order resources)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Method-3-Detection-and-recovery"><span class="toc-text">Method 3: Detection and recovery</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Strategy"><span class="toc-text">Strategy:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Detection-with-Multiple-Resources-of-Each-Type"><span class="toc-text">Detection with Multiple Resources of Each Type</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Algorithm"><span class="toc-text">Algorithm</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Recovery-from-Deadlock"><span class="toc-text">Recovery from Deadlock</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Method-4-Deadlock-Avoidance"><span class="toc-text">Method 4: Deadlock Avoidance</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Safe-and-Unsafe-states"><span class="toc-text">Safe and Unsafe states</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LiveLock"><span class="toc-text">LiveLock</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bankers-Algorithm"><span class="toc-text">Bankers Algorithm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Starvation"><span class="toc-text">Starvation</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lec05-Processes-and-Threads-Implementation"><span class="toc-text">Lec05 Processes and Threads Implementation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MIPS-Registers"><span class="toc-text">MIPS Registers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Branching-and-Jumping"><span class="toc-text">Branching and Jumping</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Process"><span class="toc-text">Process</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Memory-allocation"><span class="toc-text">Memory allocation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mode-distinguish"><span class="toc-text">Mode distinguish</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#User-level-Threads"><span class="toc-text">User-level Threads</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Pros"><span class="toc-text">Pros</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Cons"><span class="toc-text">Cons</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kernel-provided-Threads"><span class="toc-text">Kernel-provided Threads</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Cons-1"><span class="toc-text">Cons</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Pros-1"><span class="toc-text">Pros</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Context-Switch"><span class="toc-text">Context Switch</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Context-Switch-Occurrence"><span class="toc-text">Context Switch Occurrence</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Context-Switch-Addition"><span class="toc-text">Context Switch Addition</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lec06-Syscalls"><span class="toc-text">Lec06 Syscalls</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Syscall-Definition"><span class="toc-text">Syscall Definition</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CPU-Computation-Model"><span class="toc-text">CPU Computation Model</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Privileged-mode-operation"><span class="toc-text">Privileged-mode operation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#System-call-mechanism-overview"><span class="toc-text">System call mechanism overview</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Coprocessor-0-CP0"><span class="toc-text">Coprocessor 0 (CP0)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Exception-management"><span class="toc-text">Exception management</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#C0-status"><span class="toc-text">C0_status</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%C2%B7c0-cause"><span class="toc-text">·c0_cause</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#C0-epc"><span class="toc-text">C0_epc</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hardware-Exception-handling"><span class="toc-text">Hardware Exception handling</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MIPS-System-Calls"><span class="toc-text">MIPS System Calls</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OS-x2F-161-Systems-Calls"><span class="toc-text">OS&#x2F;161 Systems Calls</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Summary-of-System-Call-in-User-Mode"><span class="toc-text">Summary of System Call in User Mode</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#System-Calls-%E2%80%93-Kernel-Side"><span class="toc-text">System Calls – Kernel Side</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lec07-Computer-Hardware-Review"><span class="toc-text">Lec07 Computer Hardware Review</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Memory-Hierarchy"><span class="toc-text">Memory Hierarchy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cashing"><span class="toc-text">Cashing</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CPU-cache"><span class="toc-text">CPU cache</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Performance"><span class="toc-text">Performance</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Effective-Access-Time"><span class="toc-text">Effective Access Time</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Avoid-Waiting-for-Disk-Access"><span class="toc-text">Avoid Waiting for Disk Access</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Avoid-Waiting-for-Internet-Access"><span class="toc-text">Avoid Waiting for Internet Access</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lec08-File-Management"><span class="toc-text">Lec08 File Management</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#File-Names"><span class="toc-text">File Names</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#File-Structure"><span class="toc-text">File Structure</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#File-Types"><span class="toc-text">File Types</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#File-Access-Types-Patterns"><span class="toc-text">File Access Types (Patterns)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Typical-File-Operations"><span class="toc-text">Typical File Operations</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Criteria-for-File-Organization"><span class="toc-text">Criteria for File Organization</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#File-Directories"><span class="toc-text">File Directories</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hierarchical-Tree-Structured-Directory"><span class="toc-text">Hierarchical (Tree Structured) Directory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Relative-and-Absolute-Pathnames"><span class="toc-text">Relative and Absolute Pathnames</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Typical-Directory-Operations"><span class="toc-text">Typical Directory Operations</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nice-Properties-of-UNIX-naming"><span class="toc-text">Nice Properties of UNIX naming</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Access-Rights"><span class="toc-text">Access Rights</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Simultaneous-Access"><span class="toc-text">Simultaneous Access</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lec09-File-System-Internals"><span class="toc-text">Lec09 File System Internals</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#UNIX-Storage-Stack"><span class="toc-text">UNIX Storage Stack</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Difference-between-some-FS"><span class="toc-text">Difference between some FS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Property-of-hard-disk"><span class="toc-text">Property of hard disk</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Implementing-a-file-system"><span class="toc-text">Implementing a file system</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Requirements"><span class="toc-text">Requirements</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#File-Allocation-Methods"><span class="toc-text">File Allocation Methods</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Contiguous-Allocation"><span class="toc-text">Contiguous Allocation</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Dynamic-Allocation-Strategies"><span class="toc-text">Dynamic Allocation Strategies</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#External-and-Internal-fragmentation"><span class="toc-text">External and Internal fragmentation</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#External-fragmentation"><span class="toc-text">External fragmentation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Internal-fragmentation"><span class="toc-text">Internal fragmentation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Conclusion"><span class="toc-text">Conclusion</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dynamic-allocation-Linked-list-allocation"><span class="toc-text">Dynamic allocation : Linked list allocation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dynamic-Allocation-File-allocation-Table-FAT"><span class="toc-text">Dynamic Allocation: File allocation Table (FAT)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#File-allocation-table-disk-layout"><span class="toc-text">File allocation table disk layout</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dynamical-Allocation-inode-based-FS-structure"><span class="toc-text">Dynamical Allocation: inode-based FS structure</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Issues-1"><span class="toc-text">Issues:</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Free-block-List"><span class="toc-text">Free block List</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Bit-tables"><span class="toc-text">Bit tables</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Implementing-directories"><span class="toc-text">Implementing directories</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fixed-size-directory-entries"><span class="toc-text">Fixed-size directory entries</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Variable-size-directory-entries"><span class="toc-text">Variable-size directory entries</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Searching-Directory-methods"><span class="toc-text">Searching Directory methods</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Storing-file-attributes"><span class="toc-text">Storing file attributes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#File-system-block-size"><span class="toc-text">File system block size</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lec10-UNIX-File-Management-continue"><span class="toc-text">Lec10 UNIX File Management (continue)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Virtual-file-system-VFS"><span class="toc-text">Virtual file system (VFS)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Data-Types-in-VFS-Interface"><span class="toc-text">Data Types in VFS Interface</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#VFS"><span class="toc-text">VFS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Vnode"><span class="toc-text">Vnode</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#File-descriptors"><span class="toc-text">File descriptors</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Attributes"><span class="toc-text">Attributes</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#State-associated-with-a-file-descriptor"><span class="toc-text">State associated with a file descriptor</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Use-single-fd-table-with-no-of-table"><span class="toc-text">Use single fd table with no of table</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Per-process-File-descriptor-array"><span class="toc-text">Per-process File descriptor array</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Issue"><span class="toc-text">Issue</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Per-Process-fd-table-with-global-open-file-table"><span class="toc-text">Per-Process fd table with global open file table</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Buffer"><span class="toc-text">Buffer</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Buffer-disk-blocks"><span class="toc-text">Buffer disk blocks</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cache"><span class="toc-text">Cache</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Buffer-and-caching-are-related"><span class="toc-text">Buffer and caching are related</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cache-replacement"><span class="toc-text">Cache replacement</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#File-system-consistency"><span class="toc-text">File system consistency</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Possible-Solution"><span class="toc-text">Possible Solution</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lec11-ext2-FS"><span class="toc-text">Lec11 ext2 FS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Descriptions"><span class="toc-text">Descriptions:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#i-node"><span class="toc-text">i-node</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Inode-contents"><span class="toc-text">Inode contents</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Max-File-Size"><span class="toc-text">Max File Size</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Best-and-worse-case-access-patterns"><span class="toc-text">Best and worse case access patterns</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Worst-Case-Access-Patterns-with-Unallocated-Indirect-Blocks"><span class="toc-text">Worst Case Access Patterns with Unallocated Indirect Blocks</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Inode-Summary"><span class="toc-text">Inode Summary</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#System-V-Disk-Layout-s5fs"><span class="toc-text">System V Disk Layout (s5fs)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Problems"><span class="toc-text">Problems</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Berkeley-Fast-Filesystem-FFS"><span class="toc-text">Berkeley Fast Filesystem (FFS)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Layout-of-an-Ext2-FS"><span class="toc-text">Layout of an Ext2 FS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Layout-of-a-block-group"><span class="toc-text">Layout of a block group</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Superblocks"><span class="toc-text">Superblocks</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Group-Descriptors"><span class="toc-text">Group Descriptors</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Performance-considerations"><span class="toc-text">Performance considerations</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ext2-Directories"><span class="toc-text">Ext2 Directories</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hard-Links"><span class="toc-text">Hard Links</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reference-Count-in-inode"><span class="toc-text">Reference Count in inode</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Symbolic-links"><span class="toc-text">Symbolic links</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#File-system-reliability"><span class="toc-text">File system reliability</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Other-examples"><span class="toc-text">Other examples</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lec12-ext3-FS"><span class="toc-text">Lec12 ext3 FS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Design-goals"><span class="toc-text">Design goals</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-ext3-journal"><span class="toc-text">The ext3 journal</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Option-1-Journal-FS-data-structure-updates"><span class="toc-text">Option 1: Journal FS data structure updates</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Conclusion-1"><span class="toc-text">Conclusion</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Option-2-Journal-disk-block-updates"><span class="toc-text">Option 2: Journal disk block updates</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Conclusion-2"><span class="toc-text">Conclusion</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Journaling-Block-Device-JBD"><span class="toc-text">Journaling Block Device (JBD)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Journaling-modes"><span class="toc-text">Journaling modes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JBD-conclusion"><span class="toc-text">JBD conclusion</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lec13-memory-Management"><span class="toc-text">Lec13 memory Management</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Fixed-Partition-Summary"><span class="toc-text">Fixed Partition Summary</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dynamic-Partitioning"><span class="toc-text">Dynamic Partitioning</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Allocation"><span class="toc-text">Allocation</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Classic-Approach"><span class="toc-text">Classic Approach</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Placement"><span class="toc-text">Placement</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#First-fit-algorithm"><span class="toc-text">First-fit algorithm</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Next-fit"><span class="toc-text">Next-fit</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Best-fit"><span class="toc-text">Best-fit</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Worst-fit"><span class="toc-text">Worst-fit</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Summary"><span class="toc-text">Summary</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Compaction"><span class="toc-text">Compaction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Issues-2"><span class="toc-text">Issues</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#When-are-memory-address-bound"><span class="toc-text">When are memory address bound?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hardware-Support-for-Runtime-Binding-and-Protection"><span class="toc-text">Hardware Support for Runtime Binding and Protection</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Base-and-Limit-Registers"><span class="toc-text">Base and Limit Registers</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Pros-2"><span class="toc-text">Pros</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Cons-2"><span class="toc-text">Cons</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Swapping"><span class="toc-text">Swapping</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Virtual-memory-paging"><span class="toc-text">Virtual memory-paging</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Paging"><span class="toc-text">Paging</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Memory-Management-Unit-Translation-Look-aside-Buffer-x2F-TLB"><span class="toc-text">Memory Management Unit (Translation Look-aside Buffer&#x2F;TLB)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lec14-Virtual-memory"><span class="toc-text">Lec14 Virtual memory</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Page-based-VM"><span class="toc-text">Page-based VM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Typical-Address-space-Layout"><span class="toc-text">Typical Address space Layout</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Page-fault"><span class="toc-text">Page fault</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Shared-Pages"><span class="toc-text">Shared Pages</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Private-code-and-data"><span class="toc-text">Private code and data</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Shared-code"><span class="toc-text">Shared code</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Trashing"><span class="toc-text">Trashing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Recovery-From-Thrashing"><span class="toc-text">Recovery From Thrashing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Page-Size"><span class="toc-text">Page Size</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lec16-Multiprocessor-Systems"><span class="toc-text">Lec16 Multiprocessor Systems</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Amdahl%E2%80%99s-law"><span class="toc-text">Amdahl’s law</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bus-based-uniform-memory-access-multiprocessors"><span class="toc-text">Bus-based uniform memory access multiprocessors</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Multiprocessor-caches"><span class="toc-text">Multiprocessor caches</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Cache-consistency"><span class="toc-text">Cache consistency</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Multi-core-Processor"><span class="toc-text">Multi-core Processor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Summary-1"><span class="toc-text">Summary</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Each-CPU-has-its-own-OS"><span class="toc-text">Each CPU has its own OS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Issues-3"><span class="toc-text">Issues</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Symmetric-Multiprocessors-SMP"><span class="toc-text">Symmetric Multiprocessors (SMP)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Multiprocessor-synchronisation"><span class="toc-text">Multiprocessor synchronisation</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Test-and-set"><span class="toc-text">Test and set</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%80%A2-A-solution"><span class="toc-text">• A solution:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%80%A2-Issue"><span class="toc-text">• Issue:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Caching-does-not-help-reduce-bus-contention"><span class="toc-text">Caching does not help reduce bus contention</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Reducing-Bus-contention"><span class="toc-text">Reducing Bus contention</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Benchmark"><span class="toc-text">Benchmark</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spinning-vs-blocking-and-switching"><span class="toc-text">Spinning vs blocking and switching</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Uniprocessor"><span class="toc-text">Uniprocessor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Multiprocessor"><span class="toc-text">Multiprocessor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Trade-off"><span class="toc-text">Trade off</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Preemption-and-spinlocks"><span class="toc-text">Preemption and spinlocks</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lec17-scheduling"><span class="toc-text">Lec17 scheduling</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Basic"><span class="toc-text">Basic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Application-Behaviour"><span class="toc-text">Application Behaviour</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Observation"><span class="toc-text">Observation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Insight"><span class="toc-text">Insight</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#When-is-scheduling-performed"><span class="toc-text">When is scheduling performed</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Preemptive-versus-Non-preemptive-Scheduling-%E5%85%88%E5%8F%91%E8%B0%83%E5%BA%A6%E4%B8%8E%E5%90%8E%E5%8F%91%E8%B0%83%E5%BA%A6"><span class="toc-text">Preemptive versus Non-preemptive Scheduling 先发调度与后发调度</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Non-preemptive"><span class="toc-text">Non-preemptive</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Preemptive"><span class="toc-text">Preemptive</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Categories-of-scheduling-algorithms"><span class="toc-text">Categories of scheduling algorithms</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Goals-of-scheduling-Algorithms"><span class="toc-text">Goals of scheduling Algorithms</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#All-algorithms"><span class="toc-text">All algorithms</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Interactive-Algorithms"><span class="toc-text">Interactive Algorithms</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Real-time-Algorithms"><span class="toc-text">Real-time Algorithms</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Round-Robin-Scheduling"><span class="toc-text">Round Robin Scheduling</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Pros-3"><span class="toc-text">Pros</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Cons-3"><span class="toc-text">Cons</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Issue-how-long-should-the-timeslice-be"><span class="toc-text">Issue: how long should the timeslice be</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Priorities"><span class="toc-text">Priorities</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Con"><span class="toc-text">Con:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Traditional-UNIX-scheduler"><span class="toc-text">Traditional UNIX scheduler</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Multiprocessor-scheduling"><span class="toc-text">Multiprocessor scheduling</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#A-single-shared-ready-queue"><span class="toc-text">A single shared ready queue</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Pros-4"><span class="toc-text">Pros</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Cons-4"><span class="toc-text">Cons</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Affinity-scheduling"><span class="toc-text">Affinity scheduling</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Multiple-Queue-SMP-Scheduling"><span class="toc-text">Multiple Queue SMP Scheduling</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Pros-5"><span class="toc-text">Pros</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Cons-5"><span class="toc-text">Cons:</span></a></li></ol></li></ol></li></ol>
    </div>
</aside>
                
                
  <aside id="krw-categories" class="widget widget-kratos-categories clearfix">
    <h4 class="widget-title"><i class="fa fa-folder"></i>分类目录</h4>
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Demo/">Demo</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/notes/">notes</a><span class="category-list-count">4</span></li></ul>
  </aside>


            
                
  <aside id="krw-tags" class="widget widget-kratos-tags clearfix">
    <h4 class="widget-title"><i class="fa fa-tags"></i>标签聚合</h4>
      <div class="tag-clouds">
        <a href="/tags/COMP2511/" style="font-size: 0.8em;">COMP2511</a> <a href="/tags/COMP3231/" style="font-size: 0.6em;">COMP3231</a> <a href="/tags/DESN2000/" style="font-size: 0.6em;">DESN2000</a> <a href="/tags/test/" style="font-size: 0.6em;">test</a>
      </div>
  </aside>

            
                
  <aside id="krw-posts" class="widget widget-kratos-posts">
  <h4 class="widget-title"><i class="fa fa-file"></i>最新文章</h4>
  <div class="tab-content">
      <ul class="list-group">
        
        
          
          
            <a class="list-group-item" href="/2023/06/09/DESN2000-COMP-note/"><i class="fa  fa-book"></i> DESN2000 COMP note</a>
            
          
        
          
          
            <a class="list-group-item" href="/2023/06/09/2511-Design-note/"><i class="fa  fa-book"></i> 2511 Design note</a>
            
          
        
          
          
            <a class="list-group-item" href="/2023/06/03/2511note/"><i class="fa  fa-book"></i> 2511note</a>
            
          
        
          
          
            <a class="list-group-item" href="/2023/04/26/3231note/"><i class="fa  fa-book"></i> 3231note</a>
            
          
        
          
          
            <a class="list-group-item" href="/2023/03/21/test-for-cat/"><i class="fa  fa-book"></i> test for categories</a>
            
          
        
          
            
      </ul>
  </div>
  </aside>

            
    </div>
</section>
        
        </div>
    </div>
</div>
<footer>
    <div id="footer"  class="ap-lrc"  >
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-md-offset-3 footer-list text-center">
                    <ul class="kratos-social-icons">
                        <!-- Keep for compatibility -->
                        
                        
                        
                        
                        
                        
                        
                        <li><a target="_blank" rel="nofollow" href="https://github.com/xhmkggybzwmz"><i class="fa fa-github"></i></a></li>
                        
                        <!-- New links -->
                        
                    </ul>
                    <ul class="kratos-copyright">
                        <div>
                            <li>&copy; 2023 INAB 版权所有.</li>
                            <li>本站已运行<span id="span_dt">Loading...</span></li>
                        </div>
                        <div>
                            <li>Theme <a href="https://github.com/Candinya/Kratos-Rebirth" target="_blank">Kratos:Rebirth</a></li>
                            <li>Site built with&nbsp;<i class="fa fa-heart throb" style="color:#d43f57"></i>&nbsp;by Xhmkggybz.</li>
                        </div>
                        <div>
                            <li>Powered by <a href="https://hexo.io" target="_blank" rel="nofollow">Hexo</a></li>
                            <li>Hosted on <a href="https://github.io" target="_blank">Github Pages</a></li>
                        </div>
                        <div>
                            
                            
                        </div>
                    </ul>
                </div>
            </div>
        </div>
        <div class="kr-tool text-center">
            <div class="tool">
                
                    <div class="box search-box">
                        <a href="/search/">
                            <span class="fa fa-search"></span>
                        </a>
                    </div>
                
                
                    <div class="box theme-box" id="darkmode-switch">
                        <span class="fa fa-adjust"></span>
                    </div>
                
                
                
            </div>
            <div class="box gotop-box">
                <span class="fa fa-chevron-up"></span>
            </div>
        </div>
    </div>
</footer>
</div>
</div>

        <script defer src="/vendors/bootstrap@3.3.4/dist/js/bootstrap.min.js"></script>
<script defer src="/vendors/nprogress@0.2.0/nprogress.js"></script>
<script>
    if (!window.kr) {
        window.kr = {};
    }
    window.kr.notMobile = (!(navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)));
    window.kr.siteRoot = "/";
</script>


    <script async src="/js/candy.min.js"></script>



    <script defer src="/vendors/aplayer@1.10.1/dist/APlayer.min.js"></script>
    
    <script defer src="/vendors/meting@2.0.1/dist/Meting.min.js"></script>
    <meting-js
        server="netease"
        type="playlist"
        id="5079768480"
        order="random"
        fixed="true"
    >
    </meting-js>



    <script defer src="/vendors/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

<script defer src="/js/kratosr.min.js"></script>
<script defer src="/js/pjax.min.js"></script>



<!-- Extra support for third-party plguins  -->


    </body>
</html>